var zn=Object.defineProperty,Gi=Object.defineProperties;var Bi=Object.getOwnPropertyDescriptors;var Mr=Object.getOwnPropertySymbols;var Fi=Object.prototype.hasOwnProperty,Ii=Object.prototype.propertyIsEnumerable;var $n=(r,e,i)=>e in r?zn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,Ye=(r,e)=>{for(var i in e||(e={}))Fi.call(e,i)&&$n(r,i,e[i]);if(Mr)for(var i of Mr(e))Ii.call(e,i)&&$n(r,i,e[i]);return r},mt=(r,e)=>Gi(r,Bi(e)),o=(r,e)=>zn(r,"name",{value:e,configurable:!0});var Li=(r,e)=>{for(var i in e)zn(r,i,{get:e[i],enumerable:!0})};var x=(r,e,i)=>($n(r,typeof e!="symbol"?e+"":e,i),i);var Kn=(r,e,i)=>new Promise((c,b)=>{var w=_=>{try{V(i.next(_))}catch(v){b(v)}},M=_=>{try{V(i.throw(_))}catch(v){b(v)}},V=_=>_.done?c(_.value):Promise.resolve(_.value).then(w,M);V((i=i.apply(r,e)).next())});var Vi=(()=>{for(var r=new Uint8Array(128),e=0;e<64;e++)r[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return i=>{for(var c=i.length,b=new Uint8Array((c-(i[c-1]=="=")-(i[c-2]=="="))*3/4|0),w=0,M=0;w<c;){var V=r[i.charCodeAt(w++)],_=r[i.charCodeAt(w++)],v=r[i.charCodeAt(w++)],ee=r[i.charCodeAt(w++)];b[M++]=V<<2|_>>4,b[M++]=_<<4|v>>2,b[M++]=v<<6|ee}return b}})();function We(r){return r*Math.PI/180}o(We,"deg2rad");function Ut(r){return r*180/Math.PI}o(Ut,"rad2deg");function et(r,e,i){return e>i?et(r,i,e):Math.min(Math.max(r,e),i)}o(et,"clamp");function tt(r,e,i){if(typeof r=="number"&&typeof e=="number")return r+(e-r)*i;if(r instanceof y&&e instanceof y)return r.lerp(e,i);if(r instanceof $&&e instanceof $)return r.lerp(e,i);throw new Error(`Bad value for lerp(): ${r}, ${e}. Only number, Vec2 and Color is supported.`)}o(tt,"lerp");function nt(r,e,i,c,b){return c+(r-e)/(i-e)*(b-c)}o(nt,"map");function Br(r,e,i,c,b){return et(nt(r,e,i,c,b),c,b)}o(Br,"mapc");var Pe=class{constructor(e=0,i=e){x(this,"x",0);x(this,"y",0);this.x=e,this.y=i}static fromAngle(e){let i=We(e);return new Pe(Math.cos(i),Math.sin(i))}clone(){return new Pe(this.x,this.y)}add(...e){let i=R(...e);return new Pe(this.x+i.x,this.y+i.y)}sub(...e){let i=R(...e);return new Pe(this.x-i.x,this.y-i.y)}scale(...e){let i=R(...e);return new Pe(this.x*i.x,this.y*i.y)}dist(...e){let i=R(...e);return this.sub(i).len()}sdist(...e){let i=R(...e);return this.sub(i).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new Pe(0):this.scale(1/e)}normal(){return new Pe(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let i=R(...e);return Ut(Math.atan2(this.y-i.y,this.x-i.x))}angleBetween(...e){let i=R(...e);return Ut(Math.atan2(this.cross(i),this.dot(i)))}lerp(e,i){return new Pe(tt(this.x,e.x,i),tt(this.y,e.y,i))}slerp(e,i){let c=this.dot(e),b=this.cross(e),w=Math.atan2(b,c);return this.scale(Math.sin((1-i)*w)).add(e.scale(Math.sin(i*w))).scale(1/b)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new Pe(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new le(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},y=Pe;o(y,"Vec2"),x(y,"LEFT",new Pe(-1,0)),x(y,"RIGHT",new Pe(1,0)),x(y,"UP",new Pe(0,-1)),x(y,"DOWN",new Pe(0,1));function R(...r){if(r.length===1){if(r[0]instanceof y)return new y(r[0].x,r[0].y);if(Array.isArray(r[0])&&r[0].length===2)return new y(...r[0])}return new y(...r)}o(R,"vec2");var ge=class{constructor(e,i,c){x(this,"r",255);x(this,"g",255);x(this,"b",255);this.r=et(e,0,255),this.g=et(i,0,255),this.b=et(c,0,255)}static fromArray(e){return new ge(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new ge(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new ge(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,i,c){if(i==0)return new ge(255*c,255*c,255*c);let b=o((ee,A,Y)=>(Y<0&&(Y+=1),Y>1&&(Y-=1),Y<1/6?ee+(A-ee)*6*Y:Y<1/2?A:Y<2/3?ee+(A-ee)*(2/3-Y)*6:ee),"hue2rgb"),w=c<.5?c*(1+i):c+i-c*i,M=2*c-w,V=b(M,w,e+1/3),_=b(M,w,e),v=b(M,w,e-1/3);return new ge(Math.round(V*255),Math.round(_*255),Math.round(v*255))}clone(){return new ge(this.r,this.g,this.b)}lighten(e){return new ge(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new ge(255-this.r,255-this.g,255-this.b)}mult(e){return new ge(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,i){return new ge(tt(this.r,e.r,i),tt(this.g,e.g,i),tt(this.b,e.b,i))}toHSL(){let e=this.r/255,i=this.g/255,c=this.b/255,b=Math.max(e,i,c),w=Math.min(e,i,c),M=(b+w)/2,V=M,_=M;if(b==w)M=V=0;else{let v=b-w;switch(V=_>.5?v/(2-b-w):v/(b+w),b){case e:M=(i-c)/v+(i<c?6:0);break;case i:M=(c-e)/v+2;break;case c:M=(e-i)/v+4;break}M/=6}return[M,V,_]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},$=ge;o($,"Color"),x($,"RED",new ge(255,0,0)),x($,"GREEN",new ge(0,255,0)),x($,"BLUE",new ge(0,0,255)),x($,"YELLOW",new ge(255,255,0)),x($,"MAGENTA",new ge(255,0,255)),x($,"CYAN",new ge(0,255,255)),x($,"WHITE",new ge(255,255,255)),x($,"BLACK",new ge(0,0,0));function re(...r){if(r.length===0)return new $(255,255,255);if(r.length===1){if(r[0]instanceof $)return r[0].clone();if(typeof r[0]=="string")return $.fromHex(r[0]);if(Array.isArray(r[0])&&r[0].length===3)return $.fromArray(r[0])}return new $(...r)}o(re,"rgb");var Fr=o((r,e,i)=>$.fromHSL(r,e,i),"hsl2rgb"),se=class{constructor(e,i,c,b){x(this,"x",0);x(this,"y",0);x(this,"w",1);x(this,"h",1);this.x=e,this.y=i,this.w=c,this.h=b}scale(e){return new se(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new y(this.x,this.y)}clone(){return new se(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};o(se,"Quad");function we(r,e,i,c){return new se(r,e,i,c)}o(we,"quad");var ie=class{constructor(e){x(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e&&(this.m=e)}static translate(e){return new ie([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new ie([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=We(-e);let i=Math.cos(e),c=Math.sin(e);return new ie([1,0,0,0,0,i,-c,0,0,c,i,0,0,0,0,1])}static rotateY(e){e=We(-e);let i=Math.cos(e),c=Math.sin(e);return new ie([i,0,c,0,0,1,0,0,-c,0,i,0,0,0,0,1])}static rotateZ(e){e=We(-e);let i=Math.cos(e),c=Math.sin(e);return new ie([i,-c,0,0,c,i,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=We(-e);let i=Math.cos(e),c=Math.sin(e),b=this.m[0],w=this.m[1],M=this.m[4],V=this.m[5];return this.m[0]=b*i+w*c,this.m[1]=-b*c+w*i,this.m[4]=M*i+V*c,this.m[5]=-M*c+V*i,this}mult(e){let i=[];for(let c=0;c<4;c++)for(let b=0;b<4;b++)i[c*4+b]=this.m[0*4+b]*e.m[c*4+0]+this.m[1*4+b]*e.m[c*4+1]+this.m[2*4+b]*e.m[c*4+2]+this.m[3*4+b]*e.m[c*4+3];return new ie(i)}multVec2(e){return new y(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new y(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],i=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new y(i,e/i)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],i=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new y(e/i,i)}else return new y(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return Ut(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return Ut(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new y(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new y(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new y(0,0)}invert(){let e=[],i=this.m[10]*this.m[15]-this.m[14]*this.m[11],c=this.m[9]*this.m[15]-this.m[13]*this.m[11],b=this.m[9]*this.m[14]-this.m[13]*this.m[10],w=this.m[8]*this.m[15]-this.m[12]*this.m[11],M=this.m[8]*this.m[14]-this.m[12]*this.m[10],V=this.m[8]*this.m[13]-this.m[12]*this.m[9],_=this.m[6]*this.m[15]-this.m[14]*this.m[7],v=this.m[5]*this.m[15]-this.m[13]*this.m[7],ee=this.m[5]*this.m[14]-this.m[13]*this.m[6],A=this.m[4]*this.m[15]-this.m[12]*this.m[7],Y=this.m[4]*this.m[14]-this.m[12]*this.m[6],S=this.m[5]*this.m[15]-this.m[13]*this.m[7],X=this.m[4]*this.m[13]-this.m[12]*this.m[5],ne=this.m[6]*this.m[11]-this.m[10]*this.m[7],oe=this.m[5]*this.m[11]-this.m[9]*this.m[7],N=this.m[5]*this.m[10]-this.m[9]*this.m[6],Te=this.m[4]*this.m[11]-this.m[8]*this.m[7],O=this.m[4]*this.m[10]-this.m[8]*this.m[6],He=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*i-this.m[6]*c+this.m[7]*b,e[4]=-(this.m[4]*i-this.m[6]*w+this.m[7]*M),e[8]=this.m[4]*c-this.m[5]*w+this.m[7]*V,e[12]=-(this.m[4]*b-this.m[5]*M+this.m[6]*V),e[1]=-(this.m[1]*i-this.m[2]*c+this.m[3]*b),e[5]=this.m[0]*i-this.m[2]*w+this.m[3]*M,e[9]=-(this.m[0]*c-this.m[1]*w+this.m[3]*V),e[13]=this.m[0]*b-this.m[1]*M+this.m[2]*V,e[2]=this.m[1]*_-this.m[2]*v+this.m[3]*ee,e[6]=-(this.m[0]*_-this.m[2]*A+this.m[3]*Y),e[10]=this.m[0]*S-this.m[1]*A+this.m[3]*X,e[14]=-(this.m[0]*ee-this.m[1]*Y+this.m[2]*X),e[3]=-(this.m[1]*ne-this.m[2]*oe+this.m[3]*N),e[7]=this.m[0]*ne-this.m[2]*Te+this.m[3]*O,e[11]=-(this.m[0]*oe-this.m[1]*Te+this.m[3]*He),e[15]=this.m[0]*N-this.m[1]*O+this.m[2]*He;let W=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let qe=0;qe<4;qe++)for(let De=0;De<4;De++)e[qe*4+De]*=1/W;return new ie(e)}clone(){return new ie([...this.m])}toString(){return this.m.toString()}};o(ie,"Mat4");function Wn(r,e,i,c=b=>-Math.cos(b)){return r+(c(i)+1)/2*(e-r)}o(Wn,"wave");var _i=1103515245,ki=12345,Gr=2147483648,xt=class{constructor(e){x(this,"seed");this.seed=e}gen(){return this.seed=(_i*this.seed+ki)%Gr,this.seed/Gr}genNumber(e,i){return e+this.gen()*(i-e)}genVec2(e,i){return new y(this.genNumber(e.x,i.x),this.genNumber(e.y,i.y))}genColor(e,i){return new $(this.genNumber(e.r,i.r),this.genNumber(e.g,i.g),this.genNumber(e.b,i.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof y)return this.genVec2(R(0,0),e[0]);if(e[0]instanceof $)return this.genColor(re(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof y&&e[1]instanceof y)return this.genVec2(e[0],e[1]);if(e[0]instanceof $&&e[1]instanceof $)return this.genColor(e[0],e[1])}}};o(xt,"RNG");var Yn=new xt(Date.now());function Ir(r){return r!=null&&(Yn.seed=r),Yn.seed}o(Ir,"randSeed");function Ft(...r){return Yn.genAny(...r)}o(Ft,"rand");function Xn(...r){return Math.floor(Ft(...r))}o(Xn,"randi");function Lr(r){return Ft()<=r}o(Lr,"chance");function Vr(r){return r[Xn(r.length)]}o(Vr,"choose");function _r(r,e){return r.pos.x+r.width>e.pos.x&&r.pos.x<e.pos.x+e.width&&r.pos.y+r.height>e.pos.y&&r.pos.y<e.pos.y+e.height}o(_r,"testRectRect");function Ni(r,e){if(r.p1.x===r.p2.x&&r.p1.y===r.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let i=(e.p2.y-e.p1.y)*(r.p2.x-r.p1.x)-(e.p2.x-e.p1.x)*(r.p2.y-r.p1.y);if(i===0)return null;let c=((e.p2.x-e.p1.x)*(r.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(r.p1.x-e.p1.x))/i,b=((r.p2.x-r.p1.x)*(r.p1.y-e.p1.y)-(r.p2.y-r.p1.y)*(r.p1.x-e.p1.x))/i;return c<0||c>1||b<0||b>1?null:c}o(Ni,"testLineLineT");function yt(r,e){let i=Ni(r,e);return i?R(r.p1.x+i*(r.p2.x-r.p1.x),r.p1.y+i*(r.p2.y-r.p1.y)):null}o(yt,"testLineLine");function kr(r,e){if(Bt(r,e.p1)||Bt(r,e.p2))return!0;let i=r.points();return!!yt(e,new Ve(i[0],i[1]))||!!yt(e,new Ve(i[1],i[2]))||!!yt(e,new Ve(i[2],i[3]))||!!yt(e,new Ve(i[3],i[0]))}o(kr,"testRectLine");function Bt(r,e){return e.x>r.pos.x&&e.x<r.pos.x+r.width&&e.y>r.pos.y&&e.y<r.pos.y+r.height}o(Bt,"testRectPoint");function Nr(r,e){let i=e.sub(r.p1),c=r.p2.sub(r.p1);if(Math.abs(i.cross(c))>Number.EPSILON)return!1;let b=i.dot(c)/c.dot(c);return b>=0&&b<=1}o(Nr,"testLinePoint");function Jn(r,e){let i=r.p2.sub(r.p1),c=i.dot(i),b=r.p1.sub(e.center),w=2*i.dot(b),M=b.dot(b)-e.radius*e.radius,V=w*w-4*c*M;if(c<=Number.EPSILON||V<0)return!1;if(V==0){let _=-w/(2*c);if(_>=0&&_<=1)return!0}else{let _=(-w+Math.sqrt(V))/(2*c),v=(-w-Math.sqrt(V))/(2*c);if(_>=0&&_<=1||v>=0&&v<=1)return!0}return jr(e,r.p1)}o(Jn,"testLineCircle");function jr(r,e){return r.center.sdist(e)<r.radius*r.radius}o(jr,"testCirclePoint");function Hr(r,e){let i=e.pts[e.pts.length-1];for(let c of e.pts){if(Jn(new Ve(i,c),r))return!0;i=c}return jr(r,e.pts[0])?!0:Qn(e,r.center)}o(Hr,"testCirclePolygon");function Qn(r,e){let i=!1,c=r.pts;for(let b=0,w=c.length-1;b<c.length;w=b++)c[b].y>e.y!=c[w].y>e.y&&e.x<(c[w].x-c[b].x)*(e.y-c[b].y)/(c[w].y-c[b].y)+c[b].x&&(i=!i);return i}o(Qn,"testPolygonPoint");var Ve=class{constructor(e,i){x(this,"p1");x(this,"p2");this.p1=e.clone(),this.p2=i.clone()}transform(e){return new Ve(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return le.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Ve(this.p1,this.p2)}};o(Ve,"Line");var le=class{constructor(e,i,c){x(this,"pos");x(this,"width");x(this,"height");this.pos=e.clone(),this.width=i,this.height=c}static fromPoints(e,i){return new le(e.clone(),i.x-e.x,i.y-e.y)}center(){return new y(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Ne(this.points().map(i=>e.multVec2(i)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new le(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let i=this.pos,c=this.pos.add(this.width,this.height),b=Math.max(i.x-e.x,0,e.x-c.x),w=Math.max(i.y-e.y,0,e.y-c.y);return b*b+w*w}};o(le,"Rect");var ot=class{constructor(e,i){x(this,"center");x(this,"radius");this.center=e.clone(),this.radius=i}transform(e){return new pt(this.center,this.radius,this.radius).transform(e)}bbox(){return le.fromPoints(this.center.sub(R(this.radius)),this.center.add(R(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new ot(this.center,this.radius)}};o(ot,"Circle");var pt=class{constructor(e,i,c){x(this,"center");x(this,"radiusX");x(this,"radiusY");this.center=e.clone(),this.radiusX=i,this.radiusY=c}transform(e){return new pt(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return le.fromPoints(this.center.sub(R(this.radiusX,this.radiusY)),this.center.add(R(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new pt(this.center,this.radiusX,this.radiusY)}};o(pt,"Ellipse");var Ne=class{constructor(e){x(this,"pts");if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new Ne(this.pts.map(i=>e.multVec2(i)))}bbox(){let e=R(Number.MAX_VALUE),i=R(-Number.MAX_VALUE);for(let c of this.pts)e.x=Math.min(e.x,c.x),i.x=Math.max(i.x,c.x),e.y=Math.min(e.y,c.y),i.y=Math.max(i.y,c.y);return le.fromPoints(e,i)}area(){let e=0,i=this.pts.length;for(let c=0;c<i;c++){let b=this.pts[c],w=this.pts[(c+1)%i];e+=b.x*w.y*.5,e-=w.x*b.y*.5}return Math.abs(e)}clone(){return new Ne(this.pts.map(e=>e.clone()))}};o(Ne,"Polygon");function qr(r,e){let i=Number.MAX_VALUE,c=R(0);for(let b of[r,e])for(let w=0;w<b.pts.length;w++){let M=b.pts[w],_=b.pts[(w+1)%b.pts.length].sub(M).normal().unit(),v=Number.MAX_VALUE,ee=-Number.MAX_VALUE;for(let X=0;X<r.pts.length;X++){let ne=r.pts[X].dot(_);v=Math.min(v,ne),ee=Math.max(ee,ne)}let A=Number.MAX_VALUE,Y=-Number.MAX_VALUE;for(let X=0;X<e.pts.length;X++){let ne=e.pts[X].dot(_);A=Math.min(A,ne),Y=Math.max(Y,ne)}let S=Math.min(ee,Y)-Math.max(v,A);if(S<0)return null;if(S<Math.abs(i)){let X=Y-v,ne=A-ee;i=Math.abs(X)<Math.abs(ne)?X:ne,c=_.scale(i)}}return c}o(qr,"sat");var Et=class extends Map{constructor(...i){super(...i);x(this,"lastID");this.lastID=0}push(i){let c=this.lastID;return this.set(c,i),this.lastID++,c}pushd(i){let c=this.push(i);return()=>this.delete(c)}};o(Et,"Registry");var je=class{constructor(e){x(this,"paused",!1);x(this,"cancel");this.cancel=e}static join(e){let i=new je(()=>e.forEach(c=>c.cancel()));return Object.defineProperty(i,"paused",{get:()=>e[0].paused,set:c=>e.forEach(b=>b.paused=c)}),i.paused=!1,i}};o(je,"EventController");var Ce=class{constructor(){x(this,"handlers",new Et)}add(e){let i=this.handlers.pushd((...b)=>{c.paused||e(...b)}),c=new je(i);return c}addOnce(e){let i=this.add((...c)=>{i.cancel(),e(...c)});return i}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(i=>i(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}};o(Ce,"Event");var Xe=class{constructor(){x(this,"handlers",{})}on(e,i){return this.handlers[e]||(this.handlers[e]=new Ce),this.handlers[e].add(i)}onOnce(e,i){let c=this.on(e,(...b)=>{c.cancel(),i(...b)});return c}next(e){return new Promise(i=>{this.onOnce(e,(...c)=>i(c[0]))})}trigger(e,...i){this.handlers[e]&&this.handlers[e].trigger(...i)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var i,c;return(c=(i=this.handlers[e])==null?void 0:i.numListeners())!=null?c:0}};o(Xe,"EventHandler");function hn(r,e){if(r===e)return!0;let i=typeof r,c=typeof e;if(i!==c)return!1;if(i==="object"&&c==="object"&&r!==null&&e!==null){if(Array.isArray(r)!==Array.isArray(e))return!1;let b=Object.keys(r),w=Object.keys(e);if(b.length!==w.length)return!1;for(let M of b){let V=r[M],_=e[M];if(!hn(V,_))return!1}return!0}return!1}o(hn,"deepEq");function ji(r){let e=window.atob(r),i=e.length,c=new Uint8Array(i);for(let b=0;b<i;b++)c[b]=e.charCodeAt(b);return c.buffer}o(ji,"base64ToArrayBuffer");function zr(r){return ji(r.split(",")[1])}o(zr,"dataURLToArrayBuffer");function ln(r,e){let i=document.createElement("a");i.href=e,i.download=r,i.click()}o(ln,"download");function Zn(r,e){ln(r,"data:text/plain;charset=utf-8,"+e)}o(Zn,"downloadText");function Kr(r,e){Zn(r,JSON.stringify(e))}o(Kr,"downloadJSON");function er(r,e){let i=URL.createObjectURL(e);ln(r,i),URL.revokeObjectURL(i)}o(er,"downloadBlob");var tr=o(r=>r.match(/^data:\w+\/\w+;base64,.+/),"isDataURL");var Yr=o(r=>r.split(".").slice(0,-1).join("."),"getFileName");function Fe(r,e){return(...i)=>{let c=i.length;if(c===r.length)return r(...i);if(c===e.length)return e(...i)}}o(Fe,"overload2");var Wr=(()=>{let r=0;return()=>r++})(),Xr=o(r=>r instanceof Error?r.message:String(r),"getErrorMessage");var It=class{constructor(e=(i,c)=>i<c){x(this,"_items");x(this,"_compareFn");this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],i=this._items.pop();return this._items.length!==0&&(this._items[0]=i,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let i=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[i])&&this._items[e]>=this._items[i])break;this.swap(e,i),e=i}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let i=2*e+1;if(i<this._items.length-1&&!this._compareFn(this._items[i],this._items[i+1])&&++i,this._compareFn(this._items[e],this._items[i]))break;this.swap(e,i),e=i}}swap(e,i){[this._items[e],this._items[i]]=[this._items[i],this._items[e]]}get length(){return this._items.length}};o(It,"BinaryHeap");var Hi=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Jr(r){if(typeof r!="string")throw new TypeError("string cannot be undefined or null");let e=[],i=0,c=0;for(;i<r.length;){if(c+=qi(i+c,r),Ji(r[i+c])&&c++,Yi(r[i+c])&&c++,Wi(r[i+c])&&c++,Qi(r[i+c])){c++;continue}e.push(r.substring(i,i+c)),i+=c,c=0}return e}o(Jr,"runes");function qi(r,e){let i=e[r];if(!$i(i)||r===e.length-1)return 1;let c=i+e[r+1],b=e.substring(r+2,r+5);return $r(c)&&$r(b)?4:zi(c)&&Xi(b)?e.slice(r).indexOf(String.fromCodePoint(917631))+2:Ki(b)?4:2}o(qi,"nextUnits");function $i(r){return r&&gt(r[0].charCodeAt(0),55296,56319)}o($i,"isFirstOfSurrogatePair");function $r(r){return gt(nr(r),127462,127487)}o($r,"isRegionalIndicator");function zi(r){return gt(nr(r),127988,127988)}o(zi,"isSubdivisionFlag");function Ki(r){return gt(nr(r),127995,127999)}o(Ki,"isFitzpatrickModifier");function Yi(r){return typeof r=="string"&&gt(r.charCodeAt(0),65024,65039)}o(Yi,"isVariationSelector");function Wi(r){return typeof r=="string"&&gt(r.charCodeAt(0),8400,8447)}o(Wi,"isDiacriticalMark");function Xi(r){let e=r.codePointAt(0);return typeof r=="string"&&typeof e=="number"&&gt(e,917504,917631)}o(Xi,"isSupplementarySpecialpurposePlane");function Ji(r){return typeof r=="string"&&Hi.includes(r.charCodeAt(0))}o(Ji,"isGrapheme");function Qi(r){return typeof r=="string"&&r.charCodeAt(0)===8205}o(Qi,"isZeroWidthJoiner");function nr(r){let e=r.charCodeAt(0)-55296,i=r.charCodeAt(1)-56320;return(e<<10)+i+65536}o(nr,"codePointFromSurrogatePair");function gt(r,e,i){return r>=e&&r<=i}o(gt,"betweenInclusive");var rr={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"select","10":"lstick","16":"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"start","10":"lstick","16":"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};var wt=class{constructor(){x(this,"pressed",new Set([]));x(this,"pressedRepeat",new Set([]));x(this,"released",new Set([]));x(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}};o(wt,"ButtonState");var dn=class{constructor(){x(this,"buttonState",new wt);x(this,"stickState",new Map)}};o(dn,"GamepadState");var fn=class{constructor(){x(this,"dts",[]);x(this,"timer",0);x(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((i,c)=>i+c)/this.dts.length)),this.dts=[])}};o(fn,"FPSCounter");var Qr=o(r=>{if(!r.canvas)throw new Error("Please provide a canvas");let e={canvas:r.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new fn,timeScale:1,skipTime:!1,numFrames:0,mousePos:new y(0),mouseDeltaPos:new y(0),keyState:new wt,mouseState:new wt,mergedGamepadState:new dn,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:r.canvas.offsetWidth,lastHeight:r.canvas.offsetHeight,events:new Xe};function i(){return e.dt*e.timeScale}o(i,"dt");function c(){return e.time}o(c,"time");function b(){return e.fpsCounter.fps}o(b,"fps");function w(){return e.numFrames}o(w,"numFrames");function M(){return e.canvas.toDataURL()}o(M,"screenshot");function V(d){e.canvas.style.cursor=d}o(V,"setCursor");function _(){return e.canvas.style.cursor}o(_,"getCursor");function v(d){if(d)try{let U=e.canvas.requestPointerLock();U.catch&&U.catch(D=>console.error(D))}catch(U){console.error(U)}else document.exitPointerLock()}o(v,"setCursorLocked");function ee(){return!!document.pointerLockElement}o(ee,"isCursorLocked");function A(d){d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen()}o(A,"enterFullscreen");function Y(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}o(Y,"exitFullscreen");function S(){return document.fullscreenElement||document.webkitFullscreenElement}o(S,"getFullscreenElement");function X(d=!0){d?A(e.canvas):Y()}o(X,"setFullscreen");function ne(){return Boolean(S())}o(ne,"isFullscreen");function oe(){e.stopped=!0;for(let d in ce)e.canvas.removeEventListener(d,ce[d]);for(let d in ve)document.removeEventListener(d,ve[d]);for(let d in fe)window.removeEventListener(d,fe[d]);Ae.disconnect()}o(oe,"quit");function N(d){e.loopID!==null&&cancelAnimationFrame(e.loopID);let U=0,D=o(H=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(D);return}let me=H/1e3,Oe=me-e.realTime,pe=r.maxFPS?1/r.maxFPS:0;e.realTime=me,U+=Oe,U>pe&&(e.skipTime||(e.dt=U,e.time+=i(),e.fpsCounter.tick(e.dt)),U=0,e.skipTime=!1,e.numFrames++,Pt(),d(),Gn()),e.loopID=requestAnimationFrame(D)},"frame");D(0)}o(N,"run");function Te(){return"ontouchstart"in window||navigator.maxTouchPoints>0}o(Te,"isTouchscreen");function O(){return e.mousePos.clone()}o(O,"mousePos");function He(){return e.mouseDeltaPos.clone()}o(He,"mouseDeltaPos");function W(d="left"){return e.mouseState.pressed.has(d)}o(W,"isMousePressed");function qe(d="left"){return e.mouseState.down.has(d)}o(qe,"isMouseDown");function De(d="left"){return e.mouseState.released.has(d)}o(De,"isMouseReleased");function Me(){return e.isMouseMoved}o(Me,"isMouseMoved");function vt(d){return d===void 0?e.keyState.pressed.size>0:e.keyState.pressed.has(d)}o(vt,"isKeyPressed");function yn(d){return d===void 0?e.keyState.pressedRepeat.size>0:e.keyState.pressedRepeat.has(d)}o(yn,"isKeyPressedRepeat");function jt(d){return d===void 0?e.keyState.down.size>0:e.keyState.down.has(d)}o(jt,"isKeyDown");function Ht(d){return d===void 0?e.keyState.released.size>0:e.keyState.released.has(d)}o(Ht,"isKeyReleased");function qt(d){return d===void 0?e.mergedGamepadState.buttonState.pressed.size>0:e.mergedGamepadState.buttonState.pressed.has(d)}o(qt,"isGamepadButtonPressed");function ut(d){return d===void 0?e.mergedGamepadState.buttonState.down.size>0:e.mergedGamepadState.buttonState.down.has(d)}o(ut,"isGamepadButtonDown");function xn(d){return d===void 0?e.mergedGamepadState.buttonState.released.size>0:e.mergedGamepadState.buttonState.released.has(d)}o(xn,"isGamepadButtonReleased");function Un(d){return e.events.on("resize",d)}o(Un,"onResize");let En=Fe(d=>e.events.on("keyDown",d),(d,U)=>e.events.on("keyDown",D=>D===d&&U(d))),Sn=Fe(d=>e.events.on("keyPress",d),(d,U)=>e.events.on("keyPress",D=>D===d&&U(d))),Cn=Fe(d=>e.events.on("keyPressRepeat",d),(d,U)=>e.events.on("keyPressRepeat",D=>D===d&&U(d))),Tn=Fe(d=>e.events.on("keyRelease",d),(d,U)=>e.events.on("keyRelease",D=>D===d&&U(d))),$t=Fe(d=>e.events.on("mouseDown",U=>d(U)),(d,U)=>e.events.on("mouseDown",D=>D===d&&U(D))),zt=Fe(d=>e.events.on("mousePress",U=>d(U)),(d,U)=>e.events.on("mousePress",D=>D===d&&U(D))),Kt=Fe(d=>e.events.on("mouseRelease",U=>d(U)),(d,U)=>e.events.on("mouseRelease",D=>D===d&&U(D)));function Yt(d){return e.events.on("mouseMove",()=>d(O(),He()))}o(Yt,"onMouseMove");function Wt(d){return e.events.on("charInput",d)}o(Wt,"onCharInput");function An(d){return e.events.on("touchStart",d)}o(An,"onTouchStart");function Tt(d){return e.events.on("touchMove",d)}o(Tt,"onTouchMove");function On(d){return e.events.on("touchEnd",d)}o(On,"onTouchEnd");function Rn(d){return e.events.on("scroll",d)}o(Rn,"onScroll");function Xt(d){return e.events.on("hide",d)}o(Xt,"onHide");function Pn(d){return e.events.on("show",d)}o(Pn,"onShow");function Jt(d,U){if(typeof d=="function")return e.events.on("gamepadButtonDown",d);if(typeof d=="string"&&typeof U=="function")return e.events.on("gamepadButtonDown",D=>D===d&&U(d))}o(Jt,"onGamepadButtonDown");function Qt(d,U){if(typeof d=="function")return e.events.on("gamepadButtonPress",d);if(typeof d=="string"&&typeof U=="function")return e.events.on("gamepadButtonPress",D=>D===d&&U(d))}o(Qt,"onGamepadButtonPress");function Dn(d,U){if(typeof d=="function")return e.events.on("gamepadButtonRelease",d);if(typeof d=="string"&&typeof U=="function")return e.events.on("gamepadButtonRelease",D=>D===d&&U(d))}o(Dn,"onGamepadButtonRelease");function At(d,U){return e.events.on("gamepadStick",(D,H)=>D===d&&U(H))}o(At,"onGamepadStick");function Mn(d){e.events.on("gamepadConnect",d)}o(Mn,"onGamepadConnect");function Ot(d){e.events.on("gamepadDisconnect",d)}o(Ot,"onGamepadDisconnect");function $e(d){return e.mergedGamepadState.stickState.get(d)||new y(0)}o($e,"getGamepadStick");function Rt(){return[...e.charInputted]}o(Rt,"charInputted");function Zt(){return[...e.gamepads]}o(Zt,"getGamepads");function Pt(){e.events.trigger("input"),e.keyState.down.forEach(d=>e.events.trigger("keyDown",d)),e.mouseState.down.forEach(d=>e.events.trigger("mouseDown",d)),rt()}o(Pt,"processInput");function Gn(){e.keyState.update(),e.mouseState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((d,U)=>{e.mergedGamepadState.stickState.set(U,new y(0))}),e.charInputted=[],e.isMouseMoved=!1,e.gamepadStates.forEach(d=>{d.buttonState.update(),d.stickState.forEach((U,D)=>{d.stickState.set(D,new y(0))})})}o(Gn,"resetInput");function en(d){let U={index:d.index,isPressed:D=>e.gamepadStates.get(d.index).buttonState.pressed.has(D),isDown:D=>e.gamepadStates.get(d.index).buttonState.down.has(D),isReleased:D=>e.gamepadStates.get(d.index).buttonState.released.has(D),getStick:D=>e.gamepadStates.get(d.index).stickState.get(D)};return e.gamepads.push(U),e.gamepadStates.set(d.index,{buttonState:new wt,stickState:new Map([["left",new y(0)],["right",new y(0)]])}),U}o(en,"registerGamepad");function ae(d){e.gamepads=e.gamepads.filter(U=>U.index!==d.index),e.gamepadStates.delete(d.index)}o(ae,"removeGamepad");function rt(){var d,U,D;for(let H of navigator.getGamepads())H&&!e.gamepadStates.has(H.index)&&en(H);for(let H of e.gamepads){let me=navigator.getGamepads()[H.index],pe=(D=(U=((d=r.gamepads)!=null?d:{})[me.id])!=null?U:rr[me.id])!=null?D:rr.default,ze=e.gamepadStates.get(H.index);for(let he=0;he<me.buttons.length;he++)me.buttons[he].pressed?(ze.buttonState.down.has(pe.buttons[he])||(e.mergedGamepadState.buttonState.press(pe.buttons[he]),ze.buttonState.press(pe.buttons[he]),e.events.trigger("gamepadButtonPress",pe.buttons[he])),e.events.trigger("gamepadButtonDown",pe.buttons[he])):ze.buttonState.down.has(pe.buttons[he])&&(e.mergedGamepadState.buttonState.release(pe.buttons[he]),ze.buttonState.release(pe.buttons[he]),e.events.trigger("gamepadButtonRelease",pe.buttons[he]));for(let he in pe.sticks){let Le=pe.sticks[he],Ue=new y(me.axes[Le.x],me.axes[Le.y]);ze.stickState.set(he,Ue),e.mergedGamepadState.stickState.set(he,Ue),e.events.trigger("gamepadStick",he,Ue)}}}o(rt,"processGamepad");let ce={},ve={},fe={},Qe=r.pixelDensity||window.devicePixelRatio||1;ce.mousemove=d=>{let U=new y(d.offsetX,d.offsetY),D=new y(d.movementX,d.movementY);if(ne()){let H=e.canvas.width/Qe,me=e.canvas.height/Qe,Oe=window.innerWidth,pe=window.innerHeight,ze=Oe/pe,he=H/me;if(ze>he){let Le=pe/me,Ue=(Oe-H*Le)/2;U.x=nt(d.offsetX-Ue,0,H*Le,0,H),U.y=nt(d.offsetY,0,me*Le,0,me)}else{let Le=Oe/H,Ue=(pe-me*Le)/2;U.x=nt(d.offsetX,0,H*Le,0,H),U.y=nt(d.offsetY-Ue,0,me*Le,0,me)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=U,e.mouseDeltaPos=D,e.events.trigger("mouseMove")})};let ct=["left","middle","right","back","forward"];ce.mousedown=d=>{e.events.onOnce("input",()=>{let U=ct[d.button];U&&(e.mouseState.press(U),e.events.trigger("mousePress",U))})},ce.mouseup=d=>{e.events.onOnce("input",()=>{let U=ct[d.button];U&&(e.mouseState.release(U),e.events.trigger("mouseRelease",U))})};let Bn=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),st={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ce.keydown=d=>{Bn.has(d.key)&&d.preventDefault(),e.events.onOnce("input",()=>{let U=st[d.key]||d.key.toLowerCase();U.length===1?(e.events.trigger("charInput",U),e.charInputted.push(U)):U==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),d.repeat?(e.keyState.pressRepeat(U),e.events.trigger("keyPressRepeat",U)):(e.keyState.press(U),e.events.trigger("keyPressRepeat",U),e.events.trigger("keyPress",U))})},ce.keyup=d=>{e.events.onOnce("input",()=>{let U=st[d.key]||d.key.toLowerCase();e.keyState.release(U),e.events.trigger("keyRelease",U)})},ce.touchstart=d=>{d.preventDefault(),e.events.onOnce("input",()=>{let U=[...d.changedTouches],D=e.canvas.getBoundingClientRect();r.touchToMouse!==!1&&(e.mousePos=new y(U[0].clientX-D.x,U[0].clientY-D.y),e.mouseState.press("left"),e.events.trigger("mousePress","left")),U.forEach(H=>{e.events.trigger("touchStart",new y(H.clientX-D.x,H.clientY-D.y),H)})})},ce.touchmove=d=>{d.preventDefault(),e.events.onOnce("input",()=>{let U=[...d.changedTouches],D=e.canvas.getBoundingClientRect();r.touchToMouse!==!1&&(e.mousePos=new y(U[0].clientX-D.x,U[0].clientY-D.y),e.events.trigger("mouseMove")),U.forEach(H=>{e.events.trigger("touchMove",new y(H.clientX-D.x,H.clientY-D.y),H)})})},ce.touchend=d=>{e.events.onOnce("input",()=>{let U=[...d.changedTouches],D=e.canvas.getBoundingClientRect();r.touchToMouse!==!1&&(e.mousePos=new y(U[0].clientX-D.x,U[0].clientY-D.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),U.forEach(H=>{e.events.trigger("touchEnd",new y(H.clientX-D.x,H.clientY-D.y),H)})})},ce.touchcancel=d=>{e.events.onOnce("input",()=>{let U=[...d.changedTouches],D=e.canvas.getBoundingClientRect();r.touchToMouse!==!1&&(e.mousePos=new y(U[0].clientX-D.x,U[0].clientY-D.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),U.forEach(H=>{e.events.trigger("touchEnd",new y(H.clientX-D.x,H.clientY-D.y),H)})})},ce.wheel=d=>{d.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new y(d.deltaX,d.deltaY))})},ce.contextmenu=d=>d.preventDefault(),ve.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.events.trigger("show")):e.events.trigger("hide")},fe.gamepadconnected=d=>{let U=en(d.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",U)})},fe.gamepaddisconnected=d=>{let U=Zt().filter(D=>D.index===d.gamepad.index)[0];ae(d.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",U)})};for(let d in ce)e.canvas.addEventListener(d,ce[d]);for(let d in ve)document.addEventListener(d,ve[d]);for(let d in fe)window.addEventListener(d,fe[d]);let Ae=new ResizeObserver(d=>{for(let U of d)if(U.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return Ae.observe(e.canvas),{dt:i,time:c,run:N,canvas:e.canvas,fps:b,numFrames:w,quit:oe,setFullscreen:X,isFullscreen:ne,setCursor:V,screenshot:M,getGamepads:Zt,getCursor:_,setCursorLocked:v,isCursorLocked:ee,isTouchscreen:Te,mousePos:O,mouseDeltaPos:He,isKeyDown:jt,isKeyPressed:vt,isKeyPressedRepeat:yn,isKeyReleased:Ht,isMouseDown:qe,isMousePressed:W,isMouseReleased:De,isMouseMoved:Me,isGamepadButtonPressed:qt,isGamepadButtonDown:ut,isGamepadButtonReleased:xn,getGamepadStick:$e,charInputted:Rt,onResize:Un,onKeyDown:En,onKeyPress:Sn,onKeyPressRepeat:Cn,onKeyRelease:Tn,onMouseDown:$t,onMousePress:zt,onMouseRelease:Kt,onMouseMove:Yt,onCharInput:Wt,onTouchStart:An,onTouchMove:Tt,onTouchEnd:On,onScroll:Rn,onHide:Xt,onShow:Pn,onGamepadButtonDown:Jt,onGamepadButtonPress:Qt,onGamepadButtonRelease:Dn,onGamepadStick:At,onGamepadConnect:Mn,onGamepadDisconnect:Ot,events:e.events}},"default");var Ie=class{constructor(e,i,c,b={}){x(this,"ctx");x(this,"src",null);x(this,"glTex");x(this,"width");x(this,"height");var _,v,ee;this.ctx=e;let w=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=i,this.height=c;let M=(v={linear:w.LINEAR,nearest:w.NEAREST}[(_=b.filter)!=null?_:e.opts.texFilter])!=null?v:w.NEAREST,V=(ee={repeat:w.REPEAT,clampToEadge:w.CLAMP_TO_EDGE}[b.wrap])!=null?ee:w.CLAMP_TO_EDGE;this.bind(),i&&c&&w.texImage2D(w.TEXTURE_2D,0,w.RGBA,i,c,0,w.RGBA,w.UNSIGNED_BYTE,null),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,M),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,M),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,V),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,V),this.unbind()}static fromImage(e,i,c={}){let b=new Ie(e,i.width,i.height,c);return b.update(i),b.src=i,b}update(e,i=0,c=0){let b=this.ctx.gl;this.bind(),b.texSubImage2D(b.TEXTURE_2D,0,i,c,b.RGBA,b.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}};o(Ie,"Texture");var at=class{constructor(e,i,c,b={}){x(this,"ctx");x(this,"tex");x(this,"glFramebuffer");x(this,"glRenderbuffer");this.ctx=e;let w=e.gl;e.onDestroy(()=>this.free()),this.tex=new Ie(e,i,c,b),this.glFramebuffer=w.createFramebuffer(),this.glRenderbuffer=w.createRenderbuffer(),this.bind(),w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_STENCIL,i,c),w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,this.tex.glTex,0),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_STENCIL_ATTACHMENT,w.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,i=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,i),this.unbind();let c=this.width*4,b=new Uint8Array(c);for(let w=0;w<(this.height/2|0);w++){let M=w*c,V=(this.height-w-1)*c;b.set(i.subarray(M,M+c)),i.copyWithin(M,V,V+c),i.set(b,V)}return new ImageData(i,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),i=e.getContext("2d");return e.width=this.width,e.height=this.height,i.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}};o(at,"FrameBuffer");var Lt=class{constructor(e,i,c,b){x(this,"ctx");x(this,"glProgram");this.ctx=e,e.onDestroy(()=>this.free());let w=e.gl,M=w.createShader(w.VERTEX_SHADER),V=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(M,i),w.shaderSource(V,c),w.compileShader(M),w.compileShader(V);let _=w.createProgram();if(this.glProgram=_,w.attachShader(_,M),w.attachShader(_,V),b.forEach((v,ee)=>w.bindAttribLocation(_,ee,v)),w.linkProgram(_),!w.getProgramParameter(_,w.LINK_STATUS)){let v=w.getShaderInfoLog(M);if(v)throw new Error("VERTEX SHADER "+v);let ee=w.getShaderInfoLog(V);if(ee)throw new Error("FRAGMENT SHADER "+ee)}w.deleteShader(M),w.deleteShader(V)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let i=this.ctx.gl;for(let c in e){let b=e[c],w=i.getUniformLocation(this.glProgram,c);typeof b=="number"?i.uniform1f(w,b):b instanceof ie?i.uniformMatrix4fv(w,!1,new Float32Array(b.m)):b instanceof $?i.uniform3f(w,b.r,b.g,b.b):b instanceof y&&i.uniform2f(w,b.x,b.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};o(Lt,"Shader");var Vt=class{constructor(e,i,c,b){x(this,"ctx");x(this,"glVBuf");x(this,"glIBuf");x(this,"vqueue",[]);x(this,"iqueue",[]);x(this,"stride");x(this,"maxVertices");x(this,"maxIndices");x(this,"vertexFormat");x(this,"numDraws",0);x(this,"curPrimitive",null);x(this,"curTex",null);x(this,"curShader",null);x(this,"curUniform",{});let w=e.gl;this.vertexFormat=i,this.ctx=e,this.stride=i.reduce((M,V)=>M+V.size,0),this.maxVertices=c,this.maxIndices=b,this.glVBuf=w.createBuffer(),e.pushArrayBuffer(this.glVBuf),w.bufferData(w.ARRAY_BUFFER,c*4,w.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=w.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),w.bufferData(w.ELEMENT_ARRAY_BUFFER,b*4,w.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,i,c,b,w=null,M={}){(e!==this.curPrimitive||w!==this.curTex||b!==this.curShader||!hn(this.curUniform,M)||this.vqueue.length+i.length*this.stride>this.maxVertices||this.iqueue.length+c.length>this.maxIndices)&&this.flush();let V=this.vqueue.length/this.stride;for(let _ of i)this.vqueue.push(_);for(let _ of c)this.iqueue.push(_+V);this.curPrimitive=e,this.curShader=b,this.curTex=w,this.curUniform=M}flush(){var i,c;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(i=this.curTex)==null||i.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),(c=this.curTex)==null||c.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};o(Vt,"BatchRenderer");function bt(r){let e=[],i=o(w=>{e.push(w),r(w)},"push"),c=o(()=>{var w;e.pop(),r((w=b())!=null?w:null)},"pop"),b=o(()=>e[e.length-1],"cur");return[i,c,b]}o(bt,"genStack");function sr(r,e={}){let i=[];function c(W){i.push(W)}o(c,"onDestroy");function b(){i.forEach(W=>W()),r.getExtension("WEBGL_lose_context").loseContext()}o(b,"destroy");let w=null;function M(W){if(hn(W,w))return;w=W;let qe=W.reduce((De,Me)=>De+Me.size,0);W.reduce((De,Me,vt)=>(r.vertexAttribPointer(vt,Me.size,r.FLOAT,!1,qe*4,De),r.enableVertexAttribArray(vt),De+Me.size*4),0)}o(M,"setVertexFormat");let[V,_]=bt(W=>r.bindTexture(r.TEXTURE_2D,W)),[v,ee]=bt(W=>r.bindBuffer(r.ARRAY_BUFFER,W)),[A,Y]=bt(W=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,W)),[S,X]=bt(W=>r.bindFramebuffer(r.FRAMEBUFFER,W)),[ne,oe]=bt(W=>r.bindRenderbuffer(r.RENDERBUFFER,W)),[N,Te]=bt(({x:W,y:qe,w:De,h:Me})=>{r.viewport(W,qe,De,Me)}),[O,He]=bt(W=>r.useProgram(W));return N({x:0,y:0,w:r.drawingBufferWidth,h:r.drawingBufferHeight}),{gl:r,opts:e,onDestroy:c,destroy:b,pushTexture2D:V,popTexture2D:_,pushArrayBuffer:v,popArrayBuffer:ee,pushElementArrayBuffer:A,popElementArrayBuffer:Y,pushFramebuffer:S,popFramebuffer:X,pushRenderbuffer:ne,popRenderbuffer:oe,pushViewport:N,popViewport:Te,pushProgram:O,popProgram:He,setVertexFormat:M}}o(sr,"initGfx");var ye=class{constructor(e){x(this,"loaded",!1);x(this,"data",null);x(this,"error",null);x(this,"onLoadEvents",new Ce);x(this,"onErrorEvents",new Ce);x(this,"onFinishEvents",new Ce);e.then(i=>{this.data=i,this.onLoadEvents.trigger(i)}).catch(i=>{if(this.error=i,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(i);else throw i}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let i=new ye(Promise.resolve(e));return i.data=e,i.loaded=!0,i}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}};o(ye,"Asset");var Je=class{constructor(){x(this,"assets",new Map);x(this,"lastUID",0)}add(e,i){let c=e!=null?e:this.lastUID+++"",b=new ye(i);return this.assets.set(c,b),b}addLoaded(e,i){let c=e!=null?e:this.lastUID+++"",b=ye.loaded(i);return this.assets.set(c,b),b}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(i=>{i.loaded&&e++}),e/this.assets.size}};o(Je,"AssetBucket");function ir(r){return fetch(r).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${r}"`);return e})}o(ir,"fetchURL");function _t(r){return ir(r).then(e=>e.json())}o(_t,"fetchJSON");function Zr(r){return ir(r).then(e=>e.text())}o(Zr,"fetchText");function es(r){return ir(r).then(e=>e.arrayBuffer())}o(es,"fetchArrayBuffer");function kt(r){let e=new Image;return e.crossOrigin="anonymous",e.src=r,new Promise((i,c)=>{e.onload=()=>i(e),e.onerror=()=>c(new Error(`Failed to load image from "${r}"`))})}o(kt,"loadImg");var mn=2.5949095,ts=1.70158+1,ns=2*Math.PI/3,rs=2*Math.PI/4.5,pn={linear:r=>r,easeInSine:r=>1-Math.cos(r*Math.PI/2),easeOutSine:r=>Math.sin(r*Math.PI/2),easeInOutSine:r=>-(Math.cos(Math.PI*r)-1)/2,easeInQuad:r=>r*r,easeOutQuad:r=>1-(1-r)*(1-r),easeInOutQuad:r=>r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2,easeInCubic:r=>r*r*r,easeOutCubic:r=>1-Math.pow(1-r,3),easeInOutCubic:r=>r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2,easeInQuart:r=>r*r*r*r,easeOutQuart:r=>1-Math.pow(1-r,4),easeInOutQuart:r=>r<.5?8*r*r*r*r:1-Math.pow(-2*r+2,4)/2,easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>1-Math.pow(1-r,5),easeInOutQuint:r=>r<.5?16*r*r*r*r*r:1-Math.pow(-2*r+2,5)/2,easeInExpo:r=>r===0?0:Math.pow(2,10*r-10),easeOutExpo:r=>r===1?1:1-Math.pow(2,-10*r),easeInOutExpo:r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,easeInCirc:r=>1-Math.sqrt(1-Math.pow(r,2)),easeOutCirc:r=>Math.sqrt(1-Math.pow(r-1,2)),easeInOutCirc:r=>r<.5?(1-Math.sqrt(1-Math.pow(2*r,2)))/2:(Math.sqrt(1-Math.pow(-2*r+2,2))+1)/2,easeInBack:r=>ts*r*r*r-1.70158*r*r,easeOutBack:r=>1+ts*Math.pow(r-1,3)+1.70158*Math.pow(r-1,2),easeInOutBack:r=>r<.5?Math.pow(2*r,2)*((mn+1)*2*r-mn)/2:(Math.pow(2*r-2,2)*((mn+1)*(r*2-2)+mn)+2)/2,easeInElastic:r=>r===0?0:r===1?1:-Math.pow(2,10*r-10)*Math.sin((r*10-10.75)*ns),easeOutElastic:r=>r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r*10-.75)*ns)+1,easeInOutElastic:r=>r===0?0:r===1?1:r<.5?-(Math.pow(2,20*r-10)*Math.sin((20*r-11.125)*rs))/2:Math.pow(2,-20*r+10)*Math.sin((20*r-11.125)*rs)/2+1,easeInBounce:r=>1-pn.easeOutBounce(1-r),easeOutBounce:r=>r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375,easeInOutBounce:r=>r<.5?(1-pn.easeOutBounce(1-2*r))/2:(1+pn.easeOutBounce(2*r-1))/2},Nt=pn;var St=class{constructor(e,i,c){x(this,"textures",[]);x(this,"canvas");x(this,"c2d");x(this,"x",0);x(this,"y",0);x(this,"curHeight",0);x(this,"gfx");this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=c,this.textures=[Ie.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Ie.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let i=this.textures[this.textures.length-1],c=new y(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,c.x,c.y):this.c2d.drawImage(e,c.x,c.y),i.update(this.canvas),[i,new se(c.x/this.canvas.width,c.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}};o(St,"TexPacker");var ss="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==";var to={};Li(to,{default:()=>or});var or=Vi("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");var is="data:image/png;base64,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";var os="data:image/png;base64,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";var io="3000.1.17",as=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",gn="topleft",us=64,oo="monospace",wn="monospace",ao=36,bn=64,vn=256,cs=2048,hs=2048,ls=2048,ds=2048,fs=.1,uo=64,ar="linear",co=8,ho=4,hr=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],lo=hr.reduce((r,e)=>r+e.size,0),ms=2048,fo=ms*4*lo,mo=ms*6,po=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,go=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,ur=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,cr=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,wo=new Set(["id","require"]),bo=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Ct(r){switch(r){case"topleft":return new y(-1,-1);case"top":return new y(0,-1);case"topright":return new y(1,-1);case"left":return new y(-1,0);case"center":return new y(0,0);case"right":return new y(1,0);case"botleft":return new y(-1,1);case"bot":return new y(0,1);case"botright":return new y(1,1);default:return r}}o(Ct,"anchorPt");function vo(r){switch(r){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}o(vo,"alignPt");function yo(r){return r.createBuffer(1,1,44100)}o(yo,"createEmptyAudioBuffer");var ca=o((r={})=>{var Rr,Pr,Dr;let e=(Rr=r.root)!=null?Rr:document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let i=(Pr=r.canvas)!=null?Pr:(()=>{let t=document.createElement("canvas");return e.appendChild(t),t})(),c=(Dr=r.scale)!=null?Dr:1,b=r.width&&r.height&&!r.stretch&&!r.letterbox;b?(i.width=r.width*c,i.height=r.height*c):(i.width=i.parentElement.offsetWidth,i.height=i.parentElement.offsetHeight);let w=["outline: none","cursor: default"];if(b){let t=i.width,n=i.height;w.push(`width: ${t}px`),w.push(`height: ${n}px`)}else w.push("width: 100%"),w.push("height: 100%");r.crisp&&(w.push("image-rendering: pixelated"),w.push("image-rendering: crisp-edges")),i.style.cssText=w.join(";");let M=r.pixelDensity||window.devicePixelRatio;i.width*=M,i.height*=M,i.tabIndex=0;let V=document.createElement("canvas");V.width=vn,V.height=vn;let _=V.getContext("2d",{willReadFrequently:!0}),v=Qr({canvas:i,touchToMouse:r.touchToMouse,gamepads:r.gamepads,pixelDensity:r.pixelDensity,maxFPS:r.maxFPS}),ee=[],A=v.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),Y=sr(A,{texFilter:r.texFilter}),S=(()=>{var p,l;let t=At(ur,cr),n=Ie.fromImage(Y,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),s=r.width&&r.height?new at(Y,r.width*M*c,r.height*M*c):new at(Y,A.drawingBufferWidth,A.drawingBufferHeight),a=null,u=1;r.background&&(a=re(r.background),u=Array.isArray(r.background)?r.background[3]:1,A.clearColor(a.r/255,a.g/255,a.b/255,u!=null?u:1)),A.enable(A.BLEND),A.blendFuncSeparate(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA,A.ONE,A.ONE_MINUS_SRC_ALPHA);let f=new Vt(Y,hr,fo,mo),m=Ie.fromImage(Y,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:t,defTex:n,frameBuffer:s,postShader:null,postShaderUniform:null,renderer:f,transform:new ie,transformStack:[],bgTex:m,bgColor:a,bgAlpha:u,width:(p=r.width)!=null?p:A.drawingBufferWidth/M/c,height:(l=r.height)!=null?l:A.drawingBufferHeight/M/c,viewport:{x:0,y:0,width:A.drawingBufferWidth,height:A.drawingBufferHeight},fixed:!1}})();class X{constructor(n,s,a={},u=null){x(this,"tex");x(this,"frames",[new se(0,0,1,1)]);x(this,"anims",{});x(this,"slice9",null);this.tex=n,s&&(this.frames=s),this.anims=a,this.slice9=u}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(n,s={}){return typeof n=="string"?X.fromURL(n,s):Promise.resolve(X.fromImage(n,s))}static fromImage(n,s={}){let[a,u]=N.packer.add(n),f=s.frames?s.frames.map(m=>new se(u.x+m.x*u.w,u.y+m.y*u.h,m.w*u.w,m.h*u.h)):jt(s.sliceX||1,s.sliceY||1,u.x,u.y,u.w,u.h);return new X(a,f,s.anims,s.slice9)}static fromURL(n,s={}){return kt(n).then(a=>X.fromImage(a,s))}}o(X,"SpriteData");class ne{constructor(n){x(this,"buf");this.buf=n}static fromArrayBuffer(n){return new Promise((s,a)=>oe.ctx.decodeAudioData(n,s,a)).then(s=>new ne(s))}static fromURL(n){return tr(n)?ne.fromArrayBuffer(zr(n)):es(n).then(s=>ne.fromArrayBuffer(s))}}o(ne,"SoundData");let oe=(()=>{let t=new(window.AudioContext||window.webkitAudioContext),n=t.createGain();n.connect(t.destination);let s=new ne(yo(t));return t.decodeAudioData(or.buffer.slice(0)).then(a=>{s.buf=a}).catch(a=>{console.error("Failed to load burp: ",a)}),{ctx:t,masterNode:n,burpSnd:s}})(),N={urlPrefix:"",sprites:new Je,fonts:new Je,bitmapFonts:new Je,sounds:new Je,shaders:new Je,custom:new Je,packer:new St(Y,ls,ds),loaded:!1};function Te(t){return typeof t!="string"||tr(t)?t:N.urlPrefix+t}o(Te,"fixURL");let O={events:new Xe,objEvents:new Xe,root:In([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new y(1),angle:0,shake:0,transform:new ie}};O.root.use(kn());function He(t){return N.custom.add(null,t)}o(He,"load");function W(){let t=[N.sprites,N.sounds,N.shaders,N.fonts,N.bitmapFonts,N.custom];return t.reduce((n,s)=>n+s.progress(),0)/t.length}o(W,"loadProgress");function qe(t){return t!==void 0&&(N.urlPrefix=t),N.urlPrefix}o(qe,"loadRoot");function De(t,n){return N.custom.add(t,_t(n))}o(De,"loadJSON");class Me{constructor(n,s={}){x(this,"fontface");x(this,"filter",ar);x(this,"outline",null);x(this,"size",bn);var a,u;if(this.fontface=n,this.filter=(a=s.filter)!=null?a:ar,this.size=(u=s.size)!=null?u:bn,this.size>vn)throw new Error(`Max font size: ${vn}`);s.outline&&(this.outline={width:1,color:re(0,0,0)},typeof s.outline=="number"?this.outline.width=s.outline:typeof s.outline=="object"&&(s.outline.width&&(this.outline.width=s.outline.width),s.outline.color&&(this.outline.color=s.outline.color)))}}o(Me,"FontData");function vt(t,n,s={}){let a=new FontFace(t,typeof n=="string"?`url(${n})`:n);return document.fonts.add(a),N.fonts.add(t,a.load().catch(u=>{throw new Error(`Failed to load font from "${n}": ${u}`)}).then(u=>new Me(u,s)))}o(vt,"loadFont");function yn(t,n,s,a,u={}){return N.bitmapFonts.add(t,kt(n).then(f=>{var m;return Mn(Ie.fromImage(Y,f,u),s,a,(m=u.chars)!=null?m:as)}))}o(yn,"loadBitmapFont");function jt(t=1,n=1,s=0,a=0,u=1,f=1){let m=[],p=u/t,l=f/n;for(let h=0;h<n;h++)for(let g=0;g<t;g++)m.push(new se(s+g*p,a+h*l,p,l));return m}o(jt,"slice");function Ht(t,n){return t=Te(t),He(typeof n=="string"?new Promise((s,a)=>{_t(n).then(u=>{Ht(t,u).then(s).catch(a)})}):X.from(t).then(s=>{let a={};for(let u in n){let f=n[u],m=s.frames[0],p=ls*m.w,l=ds*m.h,h=f.frames?f.frames.map(E=>new se(m.x+(f.x+E.x)/p*m.w,m.y+(f.y+E.y)/l*m.h,E.w/p*m.w,E.h/l*m.h)):jt(f.sliceX||1,f.sliceY||1,m.x+f.x/p*m.w,m.y+f.y/l*m.h,f.width/p*m.w,f.height/l*m.h),g=new X(s.tex,h,f.anims);N.sprites.addLoaded(u,g),a[u]=g}return a}))}o(Ht,"loadSpriteAtlas");function qt(t,n={}){let s=document.createElement("canvas"),a=t[0].width,u=t[0].height;s.width=a*t.length,s.height=u;let f=s.getContext("2d");t.forEach((p,l)=>{p instanceof ImageData?f.putImageData(p,l*a,0):f.drawImage(p,l*a,0)});let m=f.getImageData(0,0,t.length*a,u);return X.fromImage(m,mt(Ye({},n),{sliceX:t.length,sliceY:1}))}o(qt,"createSpriteSheet");function ut(t,n,s={sliceX:1,sliceY:1,anims:{}}){return n=Te(n),Array.isArray(n)?n.some(a=>typeof a=="string")?N.sprites.add(t,Promise.all(n.map(a=>typeof a=="string"?kt(a):Promise.resolve(a))).then(a=>qt(a,s))):N.sprites.addLoaded(t,qt(n,s)):typeof n=="string"?N.sprites.add(t,X.from(n,s)):N.sprites.addLoaded(t,X.fromImage(n,s))}o(ut,"loadSprite");function xn(t,n){return n=Te(n),N.sprites.add(t,new Promise(s=>Kn(this,null,function*(){let a=typeof n=="string"?yield _t(n):n,u=yield Promise.all(a.frames.map(kt)),f=document.createElement("canvas");f.width=a.width,f.height=a.height*a.frames.length;let m=f.getContext("2d");u.forEach((l,h)=>{m.drawImage(l,0,h*a.height)});let p=yield ut(null,f,{sliceY:a.frames.length,anims:a.anims});s(p)})))}o(xn,"loadPedit");function Un(t,n,s){n=Te(n),s=Te(s),typeof n=="string"&&!s&&(s=Yr(n)+".json");let a=typeof s=="string"?_t(s):Promise.resolve(s);return N.sprites.add(t,a.then(u=>{let f=u.meta.size,m=u.frames.map(l=>new se(l.frame.x/f.w,l.frame.y/f.h,l.frame.w/f.w,l.frame.h/f.h)),p={};for(let l of u.meta.frameTags)l.from===l.to?p[l.name]=l.from:p[l.name]={from:l.from,to:l.to,speed:10,loop:!0,pingpong:l.direction==="pingpong"};return X.from(n,{frames:m,anims:p})}))}o(Un,"loadAseprite");function En(t,n,s){return N.shaders.addLoaded(t,At(n,s))}o(En,"loadShader");function Sn(t,n,s){n=Te(n),s=Te(s);let a=o(f=>f?Zr(f):Promise.resolve(null),"resolveUrl"),u=Promise.all([a(n),a(s)]).then(([f,m])=>At(f,m));return N.shaders.add(t,u)}o(Sn,"loadShaderURL");function Cn(t,n){return n=Te(n),N.sounds.add(t,typeof n=="string"?ne.fromURL(n):ne.fromArrayBuffer(n))}o(Cn,"loadSound");function Tn(t="bean"){return ut(t,ss)}o(Tn,"loadBean");function $t(t){return N.sprites.get(t)}o($t,"getSprite");function zt(t){return N.sounds.get(t)}o(zt,"getSound");function Kt(t){return N.fonts.get(t)}o(Kt,"getFont");function Yt(t){return N.bitmapFonts.get(t)}o(Yt,"getBitmapFont");function Wt(t){return N.shaders.get(t)}o(Wt,"getShader");function An(t){return N.custom.get(t)}o(An,"getAsset");function Tt(t){if(typeof t=="string"){let n=$t(t);if(n)return n;if(W()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof X)return ye.loaded(t);if(t instanceof ye)return t;throw new Error(`Invalid sprite: ${t}`)}}o(Tt,"resolveSprite");function On(t){if(typeof t=="string"){let n=zt(t);if(n)return n;if(W()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof ne)return ye.loaded(t);if(t instanceof ye)return t;throw new Error(`Invalid sound: ${t}`)}}o(On,"resolveSound");function Rn(t){var n;if(!t)return S.defShader;if(typeof t=="string"){let s=Wt(t);if(s)return(n=s.data)!=null?n:s;if(W()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof ye)return t.data?t.data:t;return t}o(Rn,"resolveShader");function Xt(t){var n,s,a;if(!t)return Xt((n=r.font)!=null?n:oo);if(typeof t=="string"){let u=Yt(t),f=Kt(t);if(u)return(s=u.data)!=null?s:u;if(f)return(a=f.data)!=null?a:f;if(document.fonts.check(`${bn}px ${t}`))return t;if(W()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof ye)return t.data?t.data:t;return t}o(Xt,"resolveFont");function Pn(t){return t!==void 0&&(oe.masterNode.gain.value=t),oe.masterNode.gain.value}o(Pn,"volume");function Jt(t,n={}){var J,G,te,Ee,de;let s=oe.ctx,a=(J=n.paused)!=null?J:!1,u=s.createBufferSource(),f=new Ce,m=s.createGain(),p=(G=n.seek)!=null?G:0,l=0,h=0,g=!1;u.loop=Boolean(n.loop),u.detune.value=(te=n.detune)!=null?te:0,u.playbackRate.value=(Ee=n.speed)!=null?Ee:1,u.connect(m),u.onended=()=>{var L;F()>=((L=u.buffer)==null?void 0:L.duration)&&f.trigger()},m.connect(oe.masterNode),m.gain.value=(de=n.volume)!=null?de:1;let E=o(L=>{u.buffer=L.buf,a||(l=s.currentTime,u.start(0,p),g=!0)},"start"),C=On(t);C instanceof ye&&C.onLoad(E);let F=o(()=>{if(!u.buffer)return 0;let L=a?h-l:s.currentTime-l,Z=u.buffer.duration;return u.loop?L%Z:Math.min(L,Z)},"getTime"),P=o(L=>{let Z=s.createBufferSource();return Z.buffer=L.buffer,Z.loop=L.loop,Z.playbackRate.value=L.playbackRate.value,Z.detune.value=L.detune.value,Z.onended=L.onended,Z.connect(m),Z},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(L){if(a!==L)if(a=L,L)g&&(u.stop(),g=!1),h=s.currentTime;else{u=P(u);let Z=h-l;u.start(0,Z),g=!0,l=s.currentTime-Z,h=0}},get paused(){return a},play(L=0){this.seek(L),this.paused=!1},seek(L){var Z;(Z=u.buffer)!=null&&Z.duration&&(L>u.buffer.duration||(a?(u=P(u),l=h-L):(u.stop(),u=P(u),l=s.currentTime-L,u.start(0,L),g=!0,h=0)))},set speed(L){u.playbackRate.value=L},get speed(){return u.playbackRate.value},set detune(L){u.detune.value=L},get detune(){return u.detune.value},set volume(L){m.gain.value=Math.max(L,0)},get volume(){return m.gain.value},set loop(L){u.loop=L},get loop(){return u.loop},duration(){var L,Z;return(Z=(L=u.buffer)==null?void 0:L.duration)!=null?Z:0},time(){return F()%this.duration()},onEnd(L){return f.add(L)},then(L){return this.onEnd(L)}}}o(Jt,"play");function Qt(t){return Jt(oe.burpSnd,t)}o(Qt,"burp");function Dn(t,n){return new at(Y,t,n)}o(Dn,"makeCanvas");function At(t=ur,n=cr){let s=po.replace("{{user}}",t!=null?t:ur),a=go.replace("{{user}}",n!=null?n:cr);try{return new Lt(Y,s,a,hr.map(u=>u.name))}catch(u){let m=new RegExp("(?<type>^\\w+) SHADER ERROR: 0:(?<line>\\d+): (?<msg>.+)"),p=Xr(u).match(m),l=Number(p.groups.line)-14,h=p.groups.msg.trim(),g=p.groups.type.toLowerCase();throw new Error(`${g} shader line ${l}: ${h}`)}}o(At,"makeShader");function Mn(t,n,s,a){let u=t.width/n,f={},m=a.split("").entries();for(let[p,l]of m)f[l]=new se(p%u*n,Math.floor(p/u)*s,n,s);return{tex:t,map:f,size:s}}o(Mn,"makeFont");function Ot(t,n,s,a=S.defTex,u=S.defShader,f={}){let m=Rn(u);if(!m||m instanceof ye)return;let p=S.fixed||s?S.transform:O.cam.transform.mult(S.transform),l=[];for(let h of t){let g=Gn(p.multVec2(h.pos));l.push(g.x,g.y,h.uv.x,h.uv.y,h.color.r/255,h.color.g/255,h.color.b/255,h.opacity)}S.renderer.push(A.TRIANGLES,l,n,m,a,f)}o(Ot,"drawRaw");function $e(){S.renderer.flush()}o($e,"flush");function Rt(){A.clear(A.COLOR_BUFFER_BIT),S.frameBuffer.bind(),A.clear(A.COLOR_BUFFER_BIT),S.bgColor||Ue(()=>{Qe({width:Re(),height:Ge(),quad:new se(0,0,Re()/us,Ge()/us),tex:S.bgTex,fixed:!0})}),S.renderer.numDraws=0,S.fixed=!1,S.transformStack.length=0,S.transform=new ie}o(Rt,"frameStart");function Zt(t,n){S.postShader=t,S.postShaderUniform=n!=null?n:null}o(Zt,"usePostEffect");function Pt(){$e(),S.lastDrawCalls=S.renderer.numDraws,S.frameBuffer.unbind(),A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight);let t=S.width,n=S.height;S.width=A.drawingBufferWidth/M,S.height=A.drawingBufferHeight/M,ct({flipY:!0,tex:S.frameBuffer.tex,pos:new y(S.viewport.x,S.viewport.y),width:S.viewport.width,height:S.viewport.height,shader:S.postShader,uniform:typeof S.postShaderUniform=="function"?S.postShaderUniform():S.postShaderUniform,fixed:!0}),$e(),S.width=t,S.height=n}o(Pt,"frameEnd");function Gn(t){return new y(t.x/Re()*2-1,-t.y/Ge()*2+1)}o(Gn,"screen2ndc");function en(t){S.transform=t.clone()}o(en,"pushMatrix");function ae(...t){if(t[0]===void 0)return;let n=R(...t);n.x===0&&n.y===0||S.transform.translate(n)}o(ae,"pushTranslate");function rt(...t){if(t[0]===void 0)return;let n=R(...t);n.x===1&&n.y===1||S.transform.scale(n)}o(rt,"pushScale");function ce(t){t&&S.transform.rotate(t)}o(ce,"pushRotate");function ve(){S.transformStack.push(S.transform.clone())}o(ve,"pushTransform");function fe(){S.transformStack.length>0&&(S.transform=S.transformStack.pop())}o(fe,"popTransform");function Qe(t){var P;if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let n=t.width,s=t.height,u=Ct(t.anchor||gn).scale(new y(n,s).scale(-.5)),f=t.quad||new se(0,0,1,1),m=t.color||re(255,255,255),p=(P=t.opacity)!=null?P:1,l=t.tex?fs/t.tex.width:0,h=t.tex?fs/t.tex.height:0,g=f.x+l,E=f.y+h,C=f.w-l*2,F=f.h-h*2;ve(),ae(t.pos),ce(t.angle),rt(t.scale),ae(u),Ot([{pos:new y(-n/2,s/2),uv:new y(t.flipX?g+C:g,t.flipY?E:E+F),color:m,opacity:p},{pos:new y(-n/2,-s/2),uv:new y(t.flipX?g+C:g,t.flipY?E+F:E),color:m,opacity:p},{pos:new y(n/2,-s/2),uv:new y(t.flipX?g:g+C,t.flipY?E+F:E),color:m,opacity:p},{pos:new y(n/2,s/2),uv:new y(t.flipX?g:g+C,t.flipY?E:E+F),color:m,opacity:p}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),fe()}o(Qe,"drawUVQuad");function ct(t){var f;if(!t.tex)throw new Error('drawTexture() requires property "tex".');let n=(f=t.quad)!=null?f:new se(0,0,1,1),s=t.tex.width*n.w,a=t.tex.height*n.h,u=new y(1);if(t.tiled){let m=Math.ceil((t.width||s)/s),p=Math.ceil((t.height||a)/a),h=Ct(t.anchor||gn).add(new y(1,1)).scale(.5).scale(m*s,p*a);for(let g=0;g<m;g++)for(let E=0;E<p;E++)Qe(Object.assign({},t,{pos:(t.pos||new y(0)).add(new y(s*g,a*E)).sub(h),scale:u.scale(t.scale||new y(1)),tex:t.tex,quad:n,width:s,height:a,anchor:"topleft"}))}else t.width&&t.height?(u.x=t.width/s,u.y=t.height/a):t.width?(u.x=t.width/s,u.y=u.x):t.height&&(u.y=t.height/a,u.x=u.y),Qe(Object.assign({},t,{scale:u.scale(t.scale||new y(1)),tex:t.tex,quad:n,width:s,height:a}))}o(ct,"drawTexture");function Bn(t){var a,u,f;if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let n=Tt(t.sprite);if(!n||!n.data)return;let s=n.data.frames[(a=t.frame)!=null?a:0];if(!s)throw new Error(`Frame not found: ${(u=t.frame)!=null?u:0}`);ct(Object.assign({},t,{tex:n.data.tex,quad:s.scale((f=t.quad)!=null?f:new se(0,0,1,1))}))}o(Bn,"drawSprite");function st(t,n,s,a,u,f=1){a=We(a%360),u=We(u%360),u<=a&&(u+=Math.PI*2);let m=[],p=Math.ceil((u-a)/We(8)*f),l=(u-a)/p;for(let h=a;h<u;h+=l)m.push(t.add(n*Math.cos(h),s*Math.sin(h)));return m.push(t.add(n*Math.cos(u),s*Math.sin(u))),m}o(st,"getArcPts");function Ae(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let n=t.width,s=t.height,u=Ct(t.anchor||gn).add(1,1).scale(new y(n,s).scale(-.5)),f=[new y(0,0),new y(n,0),new y(n,s),new y(0,s)];if(t.radius){let m=Math.min(Math.min(n,s)/2,t.radius);f=[new y(m,0),new y(n-m,0),...st(new y(n-m,m),m,m,270,360),new y(n,m),new y(n,s-m),...st(new y(n-m,s-m),m,m,0,90),new y(n-m,s),new y(m,s),...st(new y(m,s-m),m,m,90,180),new y(0,s-m),new y(0,m),...st(new y(m,m),m,m,180,270)]}Oe(Object.assign({},t,Ye({offset:u,pts:f},t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{})))}o(Ae,"drawRect");function d(t){let{p1:n,p2:s}=t;if(!n||!s)throw new Error('drawLine() requires properties "p1" and "p2".');let a=t.width||1,u=s.sub(n).unit().normal().scale(a*.5),f=[n.sub(u),n.add(u),s.add(u),s.sub(u)].map(m=>{var p,l;return{pos:new y(m.x,m.y),uv:new y(0),color:(p=t.color)!=null?p:$.WHITE,opacity:(l=t.opacity)!=null?l:1}});Ot(f,[0,1,3,1,2,3],t.fixed,S.defTex,t.shader,t.uniform)}o(d,"drawLine");function U(t){let n=t.pts;if(!n)throw new Error('drawLines() requires property "pts".');if(!(n.length<2))if(t.radius&&n.length>=3){let s=n[0].sdist(n[1]);for(let u=1;u<n.length-1;u++)s=Math.min(n[u].sdist(n[u+1]),s);let a=Math.min(t.radius,Math.sqrt(s)/2);d(Object.assign({},t,{p1:n[0],p2:n[1]}));for(let u=1;u<n.length-2;u++){let f=n[u],m=n[u+1];d(Object.assign({},t,{p1:f,p2:m}))}d(Object.assign({},t,{p1:n[n.length-2],p2:n[n.length-1]}))}else for(let s=0;s<n.length-1;s++)d(Object.assign({},t,{p1:n[s],p2:n[s+1]})),t.join!=="none"&&H(Object.assign({},t,{pos:n[s],radius:t.width/2}))}o(U,"drawLines");function D(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return Oe(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}o(D,"drawTriangle");function H(t){if(typeof t.radius!="number")throw new Error('drawCircle() requires property "radius".');t.radius!==0&&me(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}o(H,"drawCircle");function me(t){var m,p,l;if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(t.radiusX===0||t.radiusY===0)return;let n=(m=t.start)!=null?m:0,s=(p=t.end)!=null?p:360,a=Ct((l=t.anchor)!=null?l:"center").scale(new y(-t.radiusX,-t.radiusY)),u=st(a,t.radiusX,t.radiusY,n,s,t.resolution);u.unshift(a);let f=Object.assign({},t,Ye({pts:u,radius:0},t.gradient?{colors:[t.gradient[0],...Array(u.length-1).fill(t.gradient[1])]}:{}));if(s-n>=360&&t.outline){t.fill!==!1&&Oe(Object.assign(f,{outline:null})),Oe(Object.assign(f,{pts:u.slice(1),fill:!1}));return}Oe(f)}o(me,"drawEllipse");function Oe(t){var s,a;if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let n=t.pts.length;if(!(n<3)){if(ve(),ae(t.pos),rt(t.scale),ce(t.angle),ae(t.offset),t.fill!==!1){let u=(s=t.color)!=null?s:$.WHITE,f=t.pts.map((p,l)=>{var h;return{pos:new y(p.x,p.y),uv:new y(0,0),color:t.colors&&t.colors[l]?t.colors[l].mult(u):u,opacity:(h=t.opacity)!=null?h:1}}),m=[...Array(n-2).keys()].map(p=>[0,p+1,p+2]).flat();Ot(f,(a=t.indices)!=null?a:m,t.fixed,S.defTex,t.shader,t.uniform)}t.outline&&U({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity}),fe()}}o(Oe,"drawPolygon");function pe(t,n,s){$e(),A.clear(A.STENCIL_BUFFER_BIT),A.enable(A.STENCIL_TEST),A.stencilFunc(A.NEVER,1,255),A.stencilOp(A.REPLACE,A.REPLACE,A.REPLACE),n(),$e(),A.stencilFunc(s,1,255),A.stencilOp(A.KEEP,A.KEEP,A.KEEP),t(),$e(),A.disable(A.STENCIL_TEST)}o(pe,"drawStenciled");function ze(t,n){pe(t,n,A.EQUAL)}o(ze,"drawMasked");function he(t,n){pe(t,n,A.NOTEQUAL)}o(he,"drawSubtracted");function Le(){return(S.viewport.width+S.viewport.height)/(S.width+S.height)}o(Le,"getViewportScale");function Ue(t){$e();let n=S.width,s=S.height;S.width=S.viewport.width,S.height=S.viewport.height,t(),$e(),S.width=n,S.height=s}o(Ue,"drawUnscaled");function lr(t,n){n.pos&&(t.pos=t.pos.add(n.pos)),n.scale&&(t.scale=t.scale.scale(R(n.scale))),n.angle&&(t.angle+=n.angle),n.color&&t.ch.length===1&&(t.color=t.color.mult(n.color)),n.opacity&&(t.opacity*=n.opacity)}o(lr,"applyCharTransform");let dr=new RegExp("\\[(?<style>\\w+)\\](?<text>.*?)\\[\\/\\k<style>\\]","g");function ps(t){let n={},s=t.replace(dr,"$2"),a=0;for(let u of t.matchAll(dr)){let f=u.index-a;for(let m=0;m<u.groups.text.length;m++)n[m+f]=[u.groups.style];a+=u[0].length-u.groups.text.length}return{charStyleMap:n,text:s}}o(ps,"compileStyledText");let Fn={};function ht(t){var Ee,de,L,Z,Se,T,I,B,k,z,Q;if(t.text===void 0)throw new Error('formatText() requires property "text".');let n=Xt(t.font);if(t.text===""||n instanceof ye||!n)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:s,text:a}=ps(t.text+""),u=Jr(a);if(n instanceof Me||typeof n=="string"){let q=n instanceof Me?n.fontface.family:n,K=n instanceof Me?{outline:n.outline,filter:n.filter}:{outline:null,filter:ar},j=(Ee=Fn[q])!=null?Ee:{font:{tex:new Ie(Y,cs,hs,{filter:K.filter}),map:{},size:bn},cursor:new y(0),outline:K.outline};Fn[q]||(Fn[q]=j),n=j.font;for(let Be of u)if(!j.font.map[Be]){let be=_;be.clearRect(0,0,V.width,V.height),be.font=`${n.size}px ${q}`,be.textBaseline="top",be.textAlign="left",be.fillStyle="#ffffff";let Ze=be.measureText(Be),xe=Math.ceil(Ze.width),_e=n.size;j.outline&&(be.lineJoin="round",be.lineWidth=j.outline.width*2,be.strokeStyle=j.outline.color.toHex(),be.strokeText(Be,j.outline.width,j.outline.width),xe+=j.outline.width*2,_e+=j.outline.width*3),be.fillText(Be,(L=(de=j.outline)==null?void 0:de.width)!=null?L:0,(Se=(Z=j.outline)==null?void 0:Z.width)!=null?Se:0);let ke=be.getImageData(0,0,xe,_e);if(j.cursor.x+xe>cs&&(j.cursor.x=0,j.cursor.y+=_e,j.cursor.y>hs))throw new Error("Font atlas exceeds character limit");n.tex.update(ke,j.cursor.x,j.cursor.y),n.map[Be]=new se(j.cursor.x,j.cursor.y,xe,_e),j.cursor.x+=xe}}let f=t.size||n.size,m=R((T=t.scale)!=null?T:1).scale(f/n.size),p=(I=t.lineSpacing)!=null?I:0,l=(B=t.letterSpacing)!=null?B:0,h=0,g=0,E=0,C=[],F=[],P=0,J=null,G=null;for(;P<u.length;){let q=u[P];if(q===`
`)E+=f+p,C.push({width:h-l,chars:F}),J=null,G=null,h=0,F=[];else{let K=n.map[q];if(K){let j=K.w*m.x;t.width&&h+j>t.width&&(E+=f+p,J!=null&&(P-=F.length-J,q=u[P],K=n.map[q],j=K.w*m.x,F=F.slice(0,J-1),h=G),J=null,G=null,C.push({width:h-l,chars:F}),h=0,F=[]),F.push({tex:n.tex,width:K.w,height:K.h,quad:new se(K.x/n.tex.width,K.y/n.tex.height,K.w/n.tex.width,K.h/n.tex.height),ch:q,pos:new y(h,E),opacity:(k=t.opacity)!=null?k:1,color:(z=t.color)!=null?z:$.WHITE,scale:R(m),angle:0}),q===" "&&(J=F.length,G=h),h+=j,g=Math.max(g,h),h+=l}}P++}C.push({width:h-l,chars:F}),E+=f,t.width&&(g=t.width);let te=[];for(let q of C){let K=(g-q.width)*vo((Q=t.align)!=null?Q:"left");for(let j of q.chars){let Be=n.map[j.ch],be=te.length;if(j.pos=j.pos.add(K,0).add(Be.w*m.x*.5,Be.h*m.y*.5),t.transform){let Ze=typeof t.transform=="function"?t.transform(be,j.ch):t.transform;Ze&&lr(j,Ze)}if(s[be]){let Ze=s[be];for(let xe of Ze){let _e=t.styles[xe],ke=typeof _e=="function"?_e(be,j.ch):_e;ke&&lr(j,ke)}}te.push(j)}}return{width:g,height:E,chars:te,opt:t}}o(ht,"formatText");function fr(t){lt(ht(t))}o(fr,"drawText");function lt(t){var n;ve(),ae(t.opt.pos),ce(t.opt.angle),ae(Ct((n=t.opt.anchor)!=null?n:"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(s=>{Qe({tex:s.tex,width:s.width,height:s.height,pos:s.pos,scale:s.scale,angle:s.angle,color:s.color,opacity:s.opacity,quad:s.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),fe()}o(lt,"drawFormattedText");function Re(){return S.width}o(Re,"width");function Ge(){return S.height}o(Ge,"height");function gs(t){return new y((t.x-S.viewport.x)*Re()/S.viewport.width,(t.y-S.viewport.y)*Ge()/S.viewport.height)}o(gs,"windowToContent");function ws(t){return new y(t.x*S.viewport.width/S.width,t.y*S.viewport.height/S.height)}o(ws,"contentToView");function tn(){return gs(v.mousePos())}o(tn,"mousePos");let mr=!1,ue={inspect:!1,timeScale:1,showLog:!0,fps:()=>v.fps(),numFrames:()=>v.numFrames(),stepFrame:Cr,drawCalls:()=>S.lastDrawCalls,clearLog:()=>O.logs=[],log:t=>{var s;let n=(s=r.logMax)!=null?s:co;O.logs.unshift({msg:t,time:v.time()}),O.logs.length>n&&(O.logs=O.logs.slice(0,n))},error:t=>ue.log(new Error(t.toString?t.toString():t)),curRecording:null,numObjects:()=>jn("*",{recursive:!0}).length,get paused(){return mr},set paused(t){mr=t,t?oe.ctx.suspend():oe.ctx.resume()}};function Ke(){return v.dt()*ue.timeScale}o(Ke,"dt");function bs(...t){return t.length>0&&(O.cam.pos=R(...t)),O.cam.pos?O.cam.pos.clone():an()}o(bs,"camPos");function vs(...t){return t.length>0&&(O.cam.scale=R(...t)),O.cam.scale.clone()}o(vs,"camScale");function ys(t){return t!==void 0&&(O.cam.angle=t),O.cam.angle}o(ys,"camRot");function xs(t=12){O.cam.shake+=t}o(xs,"shake");function pr(t){return O.cam.transform.multVec2(t)}o(pr,"toScreen");function gr(t){return O.cam.transform.invert().multVec2(t)}o(gr,"toWorld");function nn(t){let n=new ie;return t.pos&&n.translate(t.pos),t.scale&&n.scale(t.scale),t.angle&&n.rotate(t.angle),t.parent?n.mult(t.parent.transform):n}o(nn,"calcTransform");function In(t=[]){let n=new Map,s={},a=new Xe,u=[],f=null,m=!1,p={id:Wr(),hidden:!1,transform:new ie,children:[],parent:null,set paused(h){if(h!==m){m=h;for(let g of u)g.paused=h}},get paused(){return m},add(h=[]){let g=Array.isArray(h)?In(h):h;if(g.parent)throw new Error("Cannot add a game obj that already has a parent.");return g.parent=this,g.transform=nn(g),this.children.push(g),g.trigger("add",g),O.events.trigger("add",g),g},readd(h){let g=this.children.indexOf(h);return g!==-1&&(this.children.splice(g,1),this.children.push(h)),h},remove(h){let g=this.children.indexOf(h);if(g!==-1){h.parent=null,this.children.splice(g,1);let E=o(C=>{C.trigger("destroy"),O.events.trigger("destroy",C),C.children.forEach(F=>E(F))},"trigger");E(h)}},removeAll(h){if(h)this.get(h).forEach(g=>this.remove(g));else for(let g of[...this.children])this.remove(g)},update(){this.paused||(this.children.sort((h,g)=>{var E,C;return((E=h.z)!=null?E:0)-((C=g.z)!=null?C:0)}).forEach(h=>h.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let h=S.fixed;this.fixed&&(S.fixed=!0),ve(),ae(this.pos),rt(this.scale),ce(this.angle);let g=this.children.sort((E,C)=>{var F,P;return((F=E.z)!=null?F:0)-((P=C.z)!=null?P:0)});if(this.mask){let E={intersect:ze,subtract:he}[this.mask];if(!E)throw new Error(`Invalid mask func: "${this.mask}"`);E(()=>{g.forEach(C=>C.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),g.forEach(E=>E.draw());fe(),S.fixed=h,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(ve(),ae(this.pos),rt(this.scale),ce(this.angle),this.children.sort((h,g)=>{var E,C;return((E=h.z)!=null?E:0)-((C=g.z)!=null?C:0)}).forEach(h=>h.drawInspect()),this.trigger("drawInspect"),fe())},use(h){if(!h)return;if(typeof h=="string")return this.use({id:h});let g=[];h.id&&(this.unuse(h.id),s[h.id]=[],g=s[h.id],n.set(h.id,h));for(let C in h){if(wo.has(C))continue;let F=Object.getOwnPropertyDescriptor(h,C);if(typeof F.value=="function"&&(h[C]=h[C].bind(this)),F.set&&Object.defineProperty(h,C,{set:F.set.bind(this)}),F.get&&Object.defineProperty(h,C,{get:F.get.bind(this)}),bo.has(C)){let P=C==="add"?()=>{f=o(J=>g.push(J),"onCurCompCleanup"),h[C](),f=null}:h[C];g.push(this.on(C,P).cancel)}else if(this[C]===void 0)Object.defineProperty(this,C,{get:()=>h[C],set:P=>h[C]=P,configurable:!0,enumerable:!0}),g.push(()=>delete this[C]);else throw new Error(`Duplicate component property: "${C}"`)}let E=o(()=>{if(h.require){for(let C of h.require)if(!this.c(C))throw new Error(`Component "${h.id}" requires component "${C}"`)}},"checkDeps");h.destroy&&g.push(h.destroy.bind(this)),this.exists()?(E(),h.add&&(f=o(C=>g.push(C),"onCurCompCleanup"),h.add.call(this),f=null)):h.require&&g.push(this.on("add",E).cancel)},unuse(h){s[h]&&(s[h].forEach(g=>g()),delete s[h]),n.has(h)&&n.delete(h)},c(h){return n.get(h)},get(h,g={}){let E=g.recursive?this.children.flatMap(o(function C(F){return[F,...F.children.flatMap(C)]},"recurse")):this.children;if(E=E.filter(C=>h?C.is(h):!0),g.liveUpdate){let C=o(P=>g.recursive?this.isAncestorOf(P):P.parent===this,"isChild"),F=[];F.push(Ln(P=>{C(P)&&P.is(h)&&E.push(P)})),F.push(wr(P=>{if(C(P)&&P.is(h)){let J=E.findIndex(G=>G.id===P.id);J!==-1&&E.splice(J,1)}})),this.onDestroy(()=>{for(let P of F)P.cancel()})}return E},isAncestorOf(h){return h.parent?h.parent===this||this.isAncestorOf(h.parent):!1},exists(){return O.root.isAncestorOf(this)},is(h){if(h==="*")return!0;if(Array.isArray(h)){for(let g of h)if(!this.c(g))return!1;return!0}else return this.c(h)!=null},on(h,g){let E=a.on(h,g.bind(this));return f&&f(()=>E.cancel()),E},trigger(h,...g){a.trigger(h,...g),O.objEvents.trigger(h,this,...g)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let h={};for(let[g,E]of n)h[g]=E.inspect?E.inspect():null;return h},onAdd(h){return this.on("add",h)},onUpdate(h){return this.on("update",h)},onDraw(h){return this.on("draw",h)},onDestroy(h){return this.on("destroy",h)},clearEvents(){a.clear()}},l=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let h of l)p[h]=(...g)=>{let E=v[h](...g);return u.push(E),p.onDestroy(()=>E.cancel()),E};for(let h of t)p.use(h);return p}o(In,"make");function it(t,n,s){return O.objEvents[t]||(O.objEvents[t]=new Et),O.objEvents.on(t,(a,...u)=>{a.is(n)&&s(a,...u)})}o(it,"on");let Us=Fe(t=>{let n=Gt([{update:t}]);return{get paused(){return n.paused},set paused(s){n.paused=s},cancel:()=>n.destroy()}},(t,n)=>it("update",t,n)),Es=Fe(t=>{let n=Gt([{draw:t}]);return{get paused(){return n.hidden},set paused(s){n.hidden=s},cancel:()=>n.destroy()}},(t,n)=>it("draw",t,n)),Ln=Fe(t=>O.events.on("add",t),(t,n)=>it("add",t,n)),wr=Fe(t=>O.events.on("destroy",t),(t,n)=>it("destroy",t,n));function Ss(t,n,s){return it("collide",t,(a,u,f)=>u.is(n)&&s(a,u,f))}o(Ss,"onCollide");function Cs(t,n,s){return it("collideUpdate",t,(a,u,f)=>u.is(n)&&s(a,u,f))}o(Cs,"onCollideUpdate");function Ts(t,n,s){return it("collideEnd",t,(a,u,f)=>u.is(n)&&s(a,u,f))}o(Ts,"onCollideEnd");function rn(t,n){jn(t,{recursive:!0}).forEach(n),Ln(t,n)}o(rn,"forAllCurrentAndFuture");let As=Fe(t=>v.onMousePress(t),(t,n)=>{let s=[];return rn(t,a=>{if(!a.area)throw new Error("onClick() requires the object to have area() component");s.push(a.onClick(()=>n(a)))}),je.join(s)});function Os(t,n){let s=[];return rn(t,a=>{if(!a.area)throw new Error("onHover() requires the object to have area() component");s.push(a.onHover(()=>n(a)))}),je.join(s)}o(Os,"onHover");function Rs(t,n){let s=[];return rn(t,a=>{if(!a.area)throw new Error("onHoverUpdate() requires the object to have area() component");s.push(a.onHoverUpdate(()=>n(a)))}),je.join(s)}o(Rs,"onHoverUpdate");function Ps(t,n){let s=[];return rn(t,a=>{if(!a.area)throw new Error("onHoverEnd() requires the object to have area() component");s.push(a.onHoverEnd(()=>n(a)))}),je.join(s)}o(Ps,"onHoverEnd");function Ds(t){O.gravity=t}o(Ds,"setGravity");function Ms(){return O.gravity}o(Ms,"getGravity");function Gs(...t){t.length===1||t.length===2?(S.bgColor=re(t[0]),t[1]&&(S.bgAlpha=t[1])):(t.length===3||t.length===4)&&(S.bgColor=re(t[0],t[1],t[2]),t[3]&&(S.bgAlpha=t[3])),A.clearColor(S.bgColor.r/255,S.bgColor.g/255,S.bgColor.b/255,S.bgAlpha)}o(Gs,"setBackground");function Bs(){return S.bgColor.clone()}o(Bs,"getBackground");function sn(...t){return{id:"pos",pos:R(...t),moveBy(...n){this.pos=this.pos.add(R(...n))},move(...n){this.moveBy(R(...n).scale(Ke()))},moveTo(...n){if(typeof n[0]=="number"&&typeof n[1]=="number")return this.moveTo(R(n[0],n[1]),n[2]);let s=n[0],a=n[1];if(a===void 0){this.pos=R(s);return}let u=s.sub(this.pos);if(u.len()<=a*Ke()){this.pos=R(s);return}this.move(u.unit().scale(a))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let n=this.worldPos();return Mt(this)?n:pr(n)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){H({color:re(255,0,0),radius:4/Le()})}}}o(sn,"pos");function on(...t){return t.length===0?on(1):{id:"scale",scale:R(...t),scaleTo(...n){this.scale=R(...n)},scaleBy(...n){this.scale.scale(R(...n))},inspect(){return`(${Dt(this.scale.x,2)}, ${Dt(this.scale.y,2)})`}}}o(on,"scale");function Fs(t){return{id:"rotate",angle:t!=null?t:0,rotateBy(n){this.angle+=n},rotateTo(n){this.angle=n},inspect(){return`${Math.round(this.angle)}`}}}o(Fs,"rotate");function Is(...t){return{id:"color",color:re(...t),inspect(){return this.color.toString()}}}o(Is,"color");function Dt(t,n){return Number(t.toFixed(n))}o(Dt,"toFixed");function Ls(t){return{id:"opacity",opacity:t!=null?t:1,inspect(){return`${Dt(this.opacity,1)}`},fadeOut(n=1,s=Nt.linear){return Hn(this.opacity,0,n,a=>this.opacity=a,s)}}}o(Ls,"opacity");function Vn(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}o(Vn,"anchor");function Vs(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}o(Vs,"z");function _s(t,n){return{id:"follow",require:["pos"],follow:{obj:t,offset:n!=null?n:R(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}o(_s,"follow");function ks(t,n){let s=typeof t=="number"?y.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(n))}}}o(ks,"move");let Ns=200;function js(t={}){var a;let n=(a=t.distance)!=null?a:Ns,s=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let u=this.screenPos(),f=new le(R(0),Re(),Ge());return!Bt(f,u)&&f.sdistToPoint(u)>n*n},onExitScreen(u){return this.on("exitView",u)},onEnterScreen(u){return this.on("enterView",u)},update(){this.isOffScreen()?(s||(this.trigger("exitView"),s=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(s&&(this.trigger("enterView"),s=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}o(js,"offscreen");function Mt(t){return t.fixed?!0:t.parent?Mt(t.parent):!1}o(Mt,"isFixed");function Hs(t={}){var a,u,f,m;let n={},s=new Set;return{id:"area",collisionIgnore:(a=t.collisionIgnore)!=null?a:[],add(){this.area.cursor&&this.onHover(()=>v.setCursor(this.area.cursor)),this.onCollideUpdate((p,l)=>{n[p.id]||this.trigger("collide",p,l),n[p.id]=l,s.add(p.id)})},update(){for(let p in n)s.has(Number(p))||(this.trigger("collideEnd",n[p].target),delete n[p]);s.clear()},drawInspect(){let p=this.localArea();ve(),rt(this.area.scale),ae(this.area.offset);let l={outline:{width:4/Le(),color:re(0,0,255)},anchor:this.anchor,fill:!1,fixed:Mt(this)};p instanceof le?Ae(mt(Ye({},l),{pos:p.pos,width:p.width,height:p.height})):p instanceof Ne?Oe(mt(Ye({},l),{pts:p.pts})):p instanceof ot&&H(mt(Ye({},l),{pos:p.center,radius:p.radius})),fe()},area:{shape:(u=t.shape)!=null?u:null,scale:t.scale?R(t.scale):R(1),offset:(f=t.offset)!=null?f:R(0),cursor:(m=t.cursor)!=null?m:null},isClicked(){return v.isMousePressed()&&this.isHovering()},isHovering(){let p=Mt(this)?tn():gr(tn());return this.hasPoint(p)},checkCollision(p){var l;return(l=n[p.id])!=null?l:null},getCollisions(){return Object.values(n)},isColliding(p){return Boolean(n[p.id])},isOverlapping(p){let l=n[p.id];return l&&l.hasOverlap()},onClick(p){let l=v.onMousePress("left",()=>{this.isHovering()&&p()});return this.onDestroy(()=>l.cancel()),l},onHover(p){let l=!1;return this.onUpdate(()=>{l?l=this.isHovering():this.isHovering()&&(l=!0,p())})},onHoverUpdate(p){return this.onUpdate(()=>{this.isHovering()&&p()})},onHoverEnd(p){let l=!1;return this.onUpdate(()=>{l?this.isHovering()||(l=!1,p()):l=this.isHovering()})},onCollide(p,l){if(typeof p=="function"&&l===void 0)return this.on("collide",p);if(typeof p=="string")return this.onCollide((h,g)=>{h.is(p)&&l(h,g)})},onCollideUpdate(p,l){if(typeof p=="function"&&l===void 0)return this.on("collideUpdate",p);if(typeof p=="string")return this.on("collideUpdate",(h,g)=>h.is(p)&&l(h,g))},onCollideEnd(p,l){if(typeof p=="function"&&l===void 0)return this.on("collideEnd",p);if(typeof p=="string")return this.on("collideEnd",h=>h.is(p)&&l(h))},hasPoint(p){return Qn(this.worldArea(),p)},resolveCollision(p){let l=this.checkCollision(p);l&&!l.resolved&&(this.pos=this.pos.add(l.displacement),l.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){var h;let p=this.localArea();if(!(p instanceof Ne||p instanceof le))throw new Error("Only support polygon and rect shapes for now");let l=this.transform.clone().scale(R((h=this.area.scale)!=null?h:1)).translate(this.area.offset);if(p instanceof le){let g=Ct(this.anchor||gn).add(1,1).scale(-.5).scale(p.width,p.height);l.translate(g)}return p.transform(l)},screenArea(){let p=this.worldArea();return Mt(this)?p:p.transform(O.cam.transform)}}}o(Hs,"area");function dt(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}o(dt,"getRenderProps");function _n(t,n={}){var p,l,h;let s=null,a=null,u=null,f=new Ce;if(!t)throw new Error("Please pass the resource name or data to sprite()");let m=o((g,E,C,F)=>{let P=R(1,1);return C&&F?(P.x=C/(g.width*E.w),P.y=F/(g.height*E.h)):C?(P.x=C/(g.width*E.w),P.y=P.x):F&&(P.y=F/(g.height*E.h),P.x=P.y),P},"calcTexScale");return{id:"sprite",width:0,height:0,frame:n.frame||0,quad:n.quad||new se(0,0,1,1),animSpeed:(p=n.animSpeed)!=null?p:1,flipX:(l=n.flipX)!=null?l:!1,flipY:(h=n.flipY)!=null?h:!1,draw(){var E,C,F;if(!s)return;let g=s.frames[(E=this.frame)!=null?E:0];if(!g)throw new Error(`Frame not found: ${(C=this.frame)!=null?C:0}`);if(s.slice9){let{left:P,right:J,top:G,bottom:te}=s.slice9,Ee=s.tex.width*g.w,de=s.tex.height*g.h,L=this.width-P-J,Z=this.height-G-te,Se=P/Ee,T=J/Ee,I=1-Se-T,B=G/de,k=te/de,z=1-B-k,Q=[we(0,0,Se,B),we(Se,0,I,B),we(Se+I,0,T,B),we(0,B,Se,z),we(Se,B,I,z),we(Se+I,B,T,z),we(0,B+z,Se,k),we(Se,B+z,I,k),we(Se+I,B+z,T,k),we(0,0,P,G),we(P,0,L,G),we(P+L,0,J,G),we(0,G,P,Z),we(P,G,L,Z),we(P+L,G,J,Z),we(0,G+Z,P,te),we(P,G+Z,L,te),we(P+L,G+Z,J,te)];for(let q=0;q<9;q++){let K=Q[q],j=Q[q+9];ct(Object.assign(dt(this),{pos:j.pos(),tex:s.tex,quad:g.scale(K),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:j.w,height:j.h}))}}else ct(Object.assign(dt(this),{tex:s.tex,quad:g.scale((F=this.quad)!=null?F:new se(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:this.width,height:this.height}))},add(){let g=o(C=>{let F=C.frames[0].clone();n.quad&&(F=F.scale(n.quad));let P=m(C.tex,F,n.width,n.height);this.width=C.tex.width*F.w*P.x,this.height=C.tex.height*F.h*P.y,n.anim&&this.play(n.anim),s=C,f.trigger(s)},"setSpriteData"),E=Tt(t);E?E.onLoad(g):Nn(()=>g(Tt(t).data))},update(){if(!a)return;let g=s.anims[a.name];if(typeof g=="number"){this.frame=g;return}if(g.speed===0)throw new Error("Sprite anim speed cannot be 0");a.timer+=Ke()*this.animSpeed,a.timer>=1/a.speed&&(a.timer=0,this.frame+=u,(this.frame<Math.min(g.from,g.to)||this.frame>Math.max(g.from,g.to))&&(a.loop?a.pingpong?(this.frame-=u,u*=-1,this.frame+=u):this.frame=g.from:(this.frame=g.to,a.onEnd(),this.stop())))},play(g,E={}){var F,P,J,G,te,Ee,de;if(!s){f.add(()=>this.play(g,E));return}let C=s.anims[g];if(C===void 0)throw new Error(`Anim not found: ${g}`);a&&this.stop(),a=typeof C=="number"?{name:g,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:g,timer:0,loop:(P=(F=E.loop)!=null?F:C.loop)!=null?P:!1,pingpong:(G=(J=E.pingpong)!=null?J:C.pingpong)!=null?G:!1,speed:(Ee=(te=E.speed)!=null?te:C.speed)!=null?Ee:10,onEnd:(de=E.onEnd)!=null?de:()=>{}},u=typeof C=="number"?null:C.from<C.to?1:-1,this.frame=typeof C=="number"?C:C.from,this.trigger("animStart",g)},stop(){if(!a)return;let g=a.name;a=null,this.trigger("animEnd",g)},numFrames(){var g;return(g=s==null?void 0:s.frames.length)!=null?g:0},curAnim(){return a==null?void 0:a.name},onAnimEnd(g){return this.on("animEnd",g)},onAnimStart(g){return this.on("animStart",g)},renderArea(){return new le(R(0),this.width,this.height)},inspect(){if(typeof t=="string")return`"${t}"`}}}o(_n,"sprite");function qs(t,n={}){var u,f;function s(m){var l,h;let p=ht(Object.assign(dt(m),{text:m.text+"",size:m.textSize,font:m.font,width:n.width&&m.width,align:m.align,letterSpacing:m.letterSpacing,lineSpacing:m.lineSpacing,transform:m.textTransform,styles:m.textStyles}));return n.width||(m.width=p.width/(((l=m.scale)==null?void 0:l.x)||1)),m.height=p.height/(((h=m.scale)==null?void 0:h.y)||1),p}o(s,"update");let a={id:"text",set text(m){t=m,s(this)},get text(){return t},textSize:(u=n.size)!=null?u:ao,font:n.font,width:(f=n.width)!=null?f:0,height:0,align:n.align,lineSpacing:n.lineSpacing,letterSpacing:n.letterSpacing,textTransform:n.transform,textStyles:n.styles,add(){Nn(()=>s(this))},draw(){lt(s(this))},renderArea(){return new le(R(0),this.width,this.height)}};return s(a),a}o(qs,"text");function $s(t,n={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:n.colors,radius:n.radius,draw(){Oe(Object.assign(dt(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:n.fill}))},renderArea(){return new Ne(this.pts)},inspect(){return this.pts.map(s=>`[${s.x},${s.y}]`).join(",")}}}o($s,"polygon");function zs(t,n,s={}){return{id:"rect",width:t,height:n,radius:s.radius||0,draw(){Ae(Object.assign(dt(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new le(R(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(zs,"rect");function Ks(t,n){return{id:"rect",width:t,height:n,draw(){Qe(Object.assign(dt(this),{width:this.width,height:this.height}))},renderArea(){return new le(R(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(Ks,"uvquad");function Ys(t,n={}){return{id:"circle",radius:t,draw(){H(Object.assign(dt(this),{radius:this.radius,fill:n.fill}))},renderArea(){return new le(new y(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}o(Ys,"circle");function Ws(t=1,n=re(0,0,0)){return{id:"outline",outline:{width:t,color:n}}}o(Ws,"outline");function kn(){return{id:"timer",wait(t,n){let s=[];n&&s.push(n);let a=0,u=this.onUpdate(()=>{a+=Ke(),a>=t&&(s.forEach(f=>f()),u.cancel())});return{get paused(){return u.paused},set paused(f){u.paused=f},cancel:u.cancel,onEnd(f){s.push(f)},then(f){return this.onEnd(f),this}}},loop(t,n){let s=null,a=o(()=>{s=this.wait(t,a),n()},"newAction");return s=this.wait(0,a),{get paused(){return s.paused},set paused(u){s.paused=u},cancel:()=>s.cancel()}},tween(t,n,s,a,u=Nt.linear){let f=0,m=[],p=this.onUpdate(()=>{f+=Ke();let l=Math.min(f/s,1);a(tt(t,n,u(l))),l===1&&(p.cancel(),a(n),m.forEach(h=>h()))});return{get paused(){return p.paused},set paused(l){p.paused=l},onEnd(l){m.push(l)},then(l){return this.onEnd(l),this},cancel(){p.cancel()},finish(){p.cancel(),a(n),m.forEach(l=>l())}}}}}o(kn,"timer");let Xs=640,Js=65536;function Qs(t={}){var u,f,m,p;let n=null,s=null,a=!1;return{id:"body",require:["pos","area"],vel:new y(0),jumpForce:(u=t.jumpForce)!=null?u:Xs,gravityScale:(f=t.gravityScale)!=null?f:1,isStatic:(m=t.isStatic)!=null?m:!1,mass:(p=t.mass)!=null?p:1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((l,h)=>{if(l.is("body")&&!h.resolved&&(this.trigger("beforePhysicsResolve",h),l.trigger("beforePhysicsResolve",h.reverse()),!h.resolved&&!(this.isStatic&&l.isStatic))){if(!this.isStatic&&!l.isStatic){let g=this.mass+l.mass;this.pos=this.pos.add(h.displacement.scale(l.mass/g)),l.pos=l.pos.add(h.displacement.scale(-this.mass/g)),this.transform=nn(this),l.transform=nn(l)}else{let g=!this.isStatic&&l.isStatic?h:h.reverse();g.source.pos=g.source.pos.add(g.displacement),g.source.transform=nn(g.source)}h.resolved=!0,this.trigger("physicsResolve",h),l.trigger("physicsResolve",h.reverse())}}),this.onPhysicsResolve(l=>{O.gravity&&(l.isBottom()&&this.isFalling()?(this.vel.y=0,n=l.target,s=l.target.pos,a?a=!1:this.trigger("ground",n)):l.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",l.target)))})},update(){var h;if(!O.gravity||this.isStatic)return;if(a&&(n=null,s=null,this.trigger("fallOff"),a=!1),n)if(!this.isColliding(n)||!n.exists()||!n.is("body"))a=!0;else{!n.pos.eq(s)&&t.stickToPlatform!==!1&&this.moveBy(n.pos.sub(s)),s=n.pos;return}let l=this.vel.y;this.vel.y+=O.gravity*this.gravityScale*Ke(),this.vel.y=Math.min(this.vel.y,(h=t.maxVelocity)!=null?h:Js),l<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return n},isGrounded(){return n!==null},isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(l){n=null,s=null,this.vel.y=-l||-this.jumpForce},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)}}}o(Qs,"body");function Zs(t=2){let n=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{n=this.numJumps})},doubleJump(s){n<=0||(n<this.numJumps&&this.trigger("doubleJump"),n--,this.jump(s))},onDoubleJump(s){return this.on("doubleJump",s)},inspect(){return`${n}`}}}o(Zs,"doubleJump");function ei(t,n){return Ye({id:"shader",shader:t},typeof n=="function"?{uniform:n(),update(){this.uniform=n()}}:{uniform:n})}o(ei,"shader");function ti(){return{id:"fixed",fixed:!0}}o(ti,"fixed");function br(t){return{id:"stay",stay:!0,scenesToStay:t}}o(br,"stay");function ni(t,n){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(s=1){this.setHP(t-s),this.trigger("hurt",s)},heal(s=1){let a=t;this.setHP(t+s),this.trigger("heal",t-a)},hp(){return t},maxHP(){return n!=null?n:null},setMaxHP(s){n=s},setHP(s){t=n?Math.min(n,s):s,t<=0&&this.trigger("death")},onHurt(s){return this.on("hurt",s)},onHeal(s){return this.on("heal",s)},onDeath(s){return this.on("death",s)},inspect(){return`${t}`}}}o(ni,"health");function ri(t,n={}){var a;if(t==null)throw new Error("lifespan() requires time");let s=(a=n.fade)!=null?a:0;return{id:"lifespan",add(){return Kn(this,null,function*(){yield Er(t),s>0&&this.opacity&&(yield Hn(this.opacity,0,s,f=>this.opacity=f,Nt.linear)),this.destroy()})}}}o(ri,"lifespan");function si(t,n,s){if(!t)throw new Error("state() requires an initial state");let a={};function u(l){a[l]||(a[l]={enter:new Ce,end:new Ce,update:new Ce,draw:new Ce})}o(u,"initStateEvents");function f(l,h,g){return u(h),a[h][l].add(g)}o(f,"on");function m(l,h,...g){u(h),a[h][l].trigger(...g)}o(m,"trigger");let p=!1;return{id:"state",state:t,enterState(l,...h){if(p=!0,n&&!n.includes(l))throw new Error(`State not found: ${l}`);let g=this.state;if(s){if(!(s!=null&&s[g]))return;let E=typeof s[g]=="string"?[s[g]]:s[g];if(!E.includes(l))throw new Error(`Cannot transition state from "${g}" to "${l}". Available transitions: ${E.map(C=>`"${C}"`).join(", ")}`)}m("end",g,...h),this.state=l,m("enter",l,...h),m("enter",`${g} -> ${l}`,...h)},onStateTransition(l,h,g){return f("enter",`${l} -> ${h}`,g)},onStateEnter(l,h){return f("enter",l,h)},onStateUpdate(l,h){return f("update",l,h)},onStateDraw(l,h){return f("draw",l,h)},onStateEnd(l,h){return f("end",l,h)},update(){p||(m("enter",t),p=!0),m("update",this.state)},draw(){m("draw",this.state)},inspect(){return this.state}}}o(si,"state");function ii(t=1){let n=0,s=!1;return{require:["opacity"],add(){this.opacity=0},update(){s||(n+=Ke(),this.opacity=nt(n,0,t,0,1),n>=t&&(this.opacity=1,s=!0))}}}o(ii,"fadeIn");function oi(t="intersect"){return{id:"mask",mask:t}}o(oi,"mask");function ai(t){return{add(){this.canvas=t}}}o(ai,"drawon");function Nn(t){N.loaded?t():O.events.on("load",t)}o(Nn,"onLoad");function ui(t,n){O.scenes[t]=n}o(ui,"scene");function ci(t,...n){if(!O.scenes[t])throw new Error(`Scene not found: ${t}`);O.events.onOnce("frameEnd",()=>{O.events.trigger("sceneLeave",t),v.events.clear(),O.events.clear(),O.objEvents.clear(),[...O.root.children].forEach(s=>{(!s.stay||s.scenesToStay&&!s.scenesToStay.includes(t))&&O.root.remove(s)}),O.root.clearEvents(),Or(),O.cam={pos:null,scale:R(1),angle:0,shake:0,transform:new ie},O.scenes[t](...n)})}o(ci,"go");function hi(t){return O.events.on("sceneLeave",t)}o(hi,"onSceneLeave");function li(t,n){try{return JSON.parse(window.localStorage[t])}catch(s){return n?(vr(t,n),n):null}}o(li,"getData");function vr(t,n){window.localStorage[t]=JSON.stringify(n)}o(vr,"setData");function yr(t,...n){let s=t(ft),a;typeof s=="function"?a=s(...n)(ft):a=s;for(let u in a)ft[u]=a[u],r.global!==!1&&(window[u]=a[u]);return ft}o(yr,"plug");function an(){return R(Re()/2,Ge()/2)}o(an,"center");let xr;(G=>(G[G.None=0]="None",G[G.Left=1]="Left",G[G.Top=2]="Top",G[G.LeftTop=3]="LeftTop",G[G.Right=4]="Right",G[G.Horizontal=5]="Horizontal",G[G.RightTop=6]="RightTop",G[G.HorizontalTop=7]="HorizontalTop",G[G.Bottom=8]="Bottom",G[G.LeftBottom=9]="LeftBottom",G[G.Vertical=10]="Vertical",G[G.LeftVertical=11]="LeftVertical",G[G.RightBottom=12]="RightBottom",G[G.HorizontalBottom=13]="HorizontalBottom",G[G.RightVertical=14]="RightVertical",G[G.All=15]="All"))(xr||(xr={}));function Ur(t={}){var p,l,h,g;let n=R(0),s=(p=t.isObstacle)!=null?p:!1,a=(l=t.cost)!=null?l:0,u=(h=t.edges)!=null?h:[],f=o(()=>{let E={left:1,top:2,right:4,bottom:8};return u.map(C=>E[C]||0).reduce((C,F)=>C|F,0)},"getEdgeMask"),m=f();return{id:"tile",tilePosOffset:(g=t.offset)!=null?g:R(0),set tilePos(E){let C=this.getLevel();n=E.clone(),this.pos=R(this.tilePos.x*C.tileWidth(),this.tilePos.y*C.tileHeight()).add(this.tilePosOffset)},get tilePos(){return n},set isObstacle(E){s!==E&&(s=E,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(E){a!==E&&(a=E,this.getLevel().invalidateNavigationMap())},get cost(){return a},set edges(E){u=E,m=f(),this.getLevel().invalidateNavigationMap()},get edges(){return u},get edgeMask(){return m},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(R(-1,0))},moveRight(){this.tilePos=this.tilePos.add(R(1,0))},moveUp(){this.tilePos=this.tilePos.add(R(0,-1))},moveDown(){this.tilePos=this.tilePos.add(R(0,1))}}}o(Ur,"tile");function di(t,n){var Se;if(!n.tileWidth||!n.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let s=Gt([sn((Se=n.pos)!=null?Se:R(0))]),a=t.length,u=0,f=null,m=null,p=null,l=null,h=o(T=>T.x+T.y*u,"tile2Hash"),g=o(T=>R(Math.floor(T%u),Math.floor(T/u)),"hash2Tile"),E=o(()=>{f=[];for(let T of s.children)C(T)},"createSpatialMap"),C=o(T=>{let I=h(T.tilePos);f[I]?f[I].push(T):f[I]=[T]},"insertIntoSpatialMap"),F=o(T=>{let I=h(T.tilePos);if(f[I]){let B=f[I].indexOf(T);B>=0&&f[I].splice(B,1)}},"removeFromSpatialMap"),P=o(()=>{let T=!1;for(let I of s.children){let B=s.pos2Tile(I.pos);(I.tilePos.x!=B.x||I.tilePos.y!=B.y)&&(T=!0,F(I),I.tilePos.x=B.x,I.tilePos.y=B.y,C(I))}T&&s.trigger("spatial_map_changed")},"updateSpatialMap"),J=o(()=>{let T=s.getSpatialMap(),I=s.numRows()*s.numColumns();m?m.length=I:m=new Array(I),m.fill(1,0,I);for(let B=0;B<T.length;B++){let k=T[B];if(k){let z=0;for(let Q of k)if(Q.isObstacle){z=1/0;break}else z+=Q.cost;m[B]=z||1}}},"createCostMap"),G=o(()=>{let T=s.getSpatialMap(),I=s.numRows()*s.numColumns();p?p.length=I:p=new Array(I),p.fill(15,0,I);for(let B=0;B<T.length;B++){let k=T[B];if(k){let z=k.length,Q=15;for(let q=0;q<z;q++)Q|=k[q].edgeMask;p[B]=Q}}},"createEdgeMap"),te=o(()=>{let T=s.numRows()*s.numColumns(),I=o((k,z)=>{let Q=[];for(Q.push(k);Q.length>0;){let q=Q.pop();L(q).forEach(K=>{l[K]<0&&(l[K]=z,Q.push(K))})}},"traverse");l?l.length=T:l=new Array(T),l.fill(-1,0,T);let B=0;for(let k=0;k<m.length;k++){if(l[k]>=0){B++;continue}I(k,B),B++}},"createConnectivityMap"),Ee=o((T,I)=>m[I],"getCost"),de=o((T,I)=>{let B=g(T),k=g(I);return B.dist(k)},"getHeuristic"),L=o((T,I)=>{let B=[],k=Math.floor(T%u),z=k>0&&p[T]&1&&m[T-1]!==1/0,Q=T>=u&&p[T]&2&&m[T-u]!==1/0,q=k<u-1&&p[T]&4&&m[T+1]!==1/0,K=T<u*a-u-1&&p[T]&8&&m[T+u]!==1/0;return I?(z&&(Q&&B.push(T-u-1),B.push(T-1),K&&B.push(T+u-1)),Q&&B.push(T-u),q&&(Q&&B.push(T-u+1),B.push(T+1),K&&B.push(T+u+1)),K&&B.push(T+u)):(z&&B.push(T-1),Q&&B.push(T-u),q&&B.push(T+1),K&&B.push(T+u)),B},"getNeighbours"),Z={id:"level",tileWidth(){return n.tileWidth},tileHeight(){return n.tileHeight},spawn(T,...I){let B=R(...I),k=(()=>{if(typeof T=="string"){if(n.tiles[T]){if(typeof n.tiles[T]!="function")throw new Error("Level symbol def must be a function returning a component list");return n.tiles[T](B)}else if(n.wildcardTile)return n.wildcardTile(T,B)}else{if(Array.isArray(T))return T;throw new Error("Expected a symbol or a component list")}})();if(!k)return null;let z=!1,Q=!1;for(let K of k)K.id==="tile"&&(Q=!0),K.id==="pos"&&(z=!0);z||k.push(sn()),Q||k.push(Ur());let q=s.add(k);return z&&(q.tilePosOffset=q.pos.clone()),q.tilePos=B,f&&(C(q),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),q},numColumns(){return u},numRows(){return a},levelWidth(){return u*this.tileWidth()},levelHeight(){return a*this.tileHeight()},tile2Pos(...T){return R(...T).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...T){let I=R(...T);return R(Math.floor(I.x/this.tileWidth()),Math.floor(I.y/this.tileHeight()))},getSpatialMap(){return f||E(),f},onSpatialMapChanged(T){return this.on("spatial_map_changed",T)},onNavigationMapInvalid(T){return this.on("navigation_map_invalid",T)},getAt(T){f||E();let I=h(T);return f[I]||[]},update(){f&&P()},invalidateNavigationMap(){m=null,p=null,l=null},onNavigationMapChanged(T){return this.on("navigation_map_changed",T)},getTilePath(T,I,B={}){var Ze;if(m||J(),p||G(),l||te(),T.x<0||T.x>=u||T.y<0||T.y>=a||I.x<0||I.x>=u||I.y<0||I.y>=a)return null;let k=h(T),z=h(I);if(m[z]===1/0)return null;if(k===z)return[];if(l[k]!=-1&&l[k]!==l[z])return null;let Q=new It((xe,_e)=>xe.cost<_e.cost);Q.insert({cost:0,node:k});let q=new Map;q.set(k,k);let K=new Map;for(K.set(k,0);Q.length!==0;){let xe=(Ze=Q.remove())==null?void 0:Ze.node;if(xe===z)break;let _e=L(xe,B.allowDiagonals);for(let ke of _e){let qn=(K.get(xe)||0)+Ee(xe,ke)+de(ke,z);(!K.has(ke)||qn<K.get(ke))&&(K.set(ke,qn),Q.insert({cost:qn,node:ke}),q.set(ke,xe))}}let j=[],Be=z,be=g(Be);for(j.push(be);Be!==k;){Be=q.get(Be);let xe=g(Be);j.push(xe)}return j.reverse()},getPath(T,I,B={}){let k=this.tileWidth(),z=this.tileHeight(),Q=this.getTilePath(this.pos2Tile(T),this.pos2Tile(I),B);return Q?[T,...Q.slice(1,-1).map(q=>q.scale(k,z).add(k/2,z/2)),I]:null}};return s.use(Z),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger("navigation_map_changed")}),t.forEach((T,I)=>{let B=T.split("");u=Math.max(B.length,u),B.forEach((k,z)=>{s.spawn(k,R(z,I))})}),s}o(di,"addLevel");function fi(t={}){var f,m;let n=null,s=null,a=null,u=null;return{id:"agent",require:["pos","tile"],agentSpeed:(f=t.speed)!=null?f:100,allowDiagonals:(m=t.allowDiagonals)!=null?m:!0,getDistanceToTarget(){return n?this.pos.dist(n):0},getNextLocation(){return s&&a?s[a]:null},getPath(){return s?s.slice():null},getTarget(){return n},isNavigationFinished(){return s?a===null:!0},isTargetReachable(){return s!==null},isTargetReached(){return n?this.pos.eq(n):!0},setTarget(p){n=p,s=this.getLevel().getPath(this.pos,n,{allowDiagonals:this.allowDiagonals}),a=s?0:null,s?(u||(u=this.getLevel().onNavigationMapChanged(()=>{s&&a!==null&&(s=this.getLevel().getPath(this.pos,n,{allowDiagonals:this.allowDiagonals}),a=s?0:null,s?this.trigger("navigation-next",this,s[a]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>u.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,s[a])):this.trigger("navigation-ended",this)},update(){if(s&&a!==null){if(this.pos.sdist(s[a])<2)if(a===s.length-1){this.pos=n.clone(),a=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else a++,this.trigger("navigation-next",this,s[a]);this.moveTo(s[a],this.agentSpeed)}},onNavigationStarted(p){return this.on("navigation-started",p)},onNavigationNext(p){return this.on("navigation-next",p)},onNavigationEnded(p){return this.on("navigation-ended",p)},onTargetReached(p){return this.on("target-reached",p)},inspect(){return JSON.stringify({target:JSON.stringify(n),path:JSON.stringify(s)})}}}o(fi,"agent");function mi(t){let n=v.canvas.captureStream(t),s=oe.ctx.createMediaStreamDestination();oe.masterNode.connect(s);let a=new MediaRecorder(n),u=[];return a.ondataavailable=f=>{f.data.size>0&&u.push(f.data)},a.onerror=()=>{oe.masterNode.disconnect(s),n.getTracks().forEach(f=>f.stop())},a.start(),{resume(){a.resume()},pause(){a.pause()},stop(){return a.stop(),oe.masterNode.disconnect(s),n.getTracks().forEach(f=>f.stop()),new Promise(f=>{a.onstop=()=>{f(new Blob(u,{type:"video/mp4"}))}})},download(f="kaboom.mp4"){this.stop().then(m=>er(f,m))}}}o(mi,"record");function pi(){return document.activeElement===v.canvas}o(pi,"isFocused");function gi(t){t.destroy()}o(gi,"destroy");let Gt=O.root.add.bind(O.root),wi=O.root.readd.bind(O.root),bi=O.root.removeAll.bind(O.root),jn=O.root.get.bind(O.root),Er=O.root.wait.bind(O.root),vi=O.root.loop.bind(O.root),Hn=O.root.tween.bind(O.root);function Sr(t=2,n=1){let s=0;return{require:["scale"],update(){let a=Math.sin(s*t)*n;a<0&&this.destroy(),this.scale=R(a),s+=Ke()}}}o(Sr,"boom");let yi=ut(null,is),xi=ut(null,os);function Ui(t,n={}){var m,p;let s=Gt([sn(t),br()]),a=(n.speed||1)*5,u=n.scale||1;s.add([_n(xi),on(0),Vn("center"),Sr(a,u),...(m=n.comps)!=null?m:[]]);let f=s.add([_n(yi),on(0),Vn("center"),kn(),...(p=n.comps)!=null?p:[]]);return f.wait(.4/a,()=>f.use(Sr(a,u))),f.onDestroy(()=>s.destroy()),s}o(Ui,"addKaboom");function Cr(){O.root.update()}o(Cr,"updateFrame");class un{constructor(n,s,a,u=!1){x(this,"source");x(this,"target");x(this,"displacement");x(this,"resolved",!1);this.source=n,this.target=s,this.displacement=a,this.resolved=u}reverse(){return new un(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}o(un,"Collision");function Ei(){let t={},n=r.hashGridSize||uo,s=new ie,a=[];function u(f){if(a.push(s.clone()),f.pos&&s.translate(f.pos),f.scale&&s.scale(f.scale),f.angle&&s.rotate(f.angle),f.transform=s.clone(),f.c("area")&&!f.paused){let m=f,l=m.worldArea().bbox(),h=Math.floor(l.pos.x/n),g=Math.floor(l.pos.y/n),E=Math.ceil((l.pos.x+l.width)/n),C=Math.ceil((l.pos.y+l.height)/n),F=new Set;for(let P=h;P<=E;P++)for(let J=g;J<=C;J++)if(!t[P])t[P]={},t[P][J]=[m];else if(!t[P][J])t[P][J]=[m];else{let G=t[P][J];e:for(let te of G){if(te.paused||!te.exists()||F.has(te.id))continue;for(let de of m.collisionIgnore)if(te.is(de))continue e;for(let de of te.collisionIgnore)if(m.is(de))continue e;let Ee=qr(m.worldArea(),te.worldArea());if(Ee){let de=new un(m,te,Ee);m.trigger("collideUpdate",te,de);let L=de.reverse();L.resolved=de.resolved,te.trigger("collideUpdate",m,L)}F.add(te.id)}G.push(m)}}f.children.forEach(u),s=a.pop()}o(u,"checkObj"),u(O.root)}o(Ei,"checkFrame");function Si(){var s;let t=O.cam,n=y.fromAngle(Ft(0,360)).scale(t.shake);t.shake=tt(t.shake,0,5*Ke()),t.transform=new ie().translate(an()).scale(t.scale).rotate(t.angle).translate(((s=t.pos)!=null?s:an()).scale(-1).add(n)),O.root.draw(),$e()}o(Si,"drawFrame");function Ci(){let t=W();O.events.numListeners("loading")>0?O.events.trigger("loading",t):Ue(()=>{let n=Re()/2,s=24,a=R(Re()/2,Ge()/2).sub(R(n/2,s/2));Ae({pos:R(0),width:Re(),height:Ge(),color:re(0,0,0)}),Ae({pos:a,width:n,height:s,fill:!1,outline:{width:4}}),Ae({pos:a,width:n*t,height:s})})}o(Ci,"drawLoadScreen");function Tr(t,n){Ue(()=>{let s=R(8);ve(),ae(t);let a=ht({text:n,font:wn,size:16,pos:s,color:re(255,255,255),fixed:!0}),u=a.width+s.x*2,f=a.height+s.x*2;t.x+u>=Re()&&ae(R(-u,0)),t.y+f>=Ge()&&ae(R(0,-f)),Ae({width:u,height:f,color:re(0,0,0),radius:4,opacity:.8,fixed:!0}),lt(a),fe()})}o(Tr,"drawInspectText");function Ti(){if(ue.inspect){let t=null;for(let n of O.root.get("*",{recursive:!0}))if(n.c("area")&&n.isHovering()){t=n;break}if(O.root.drawInspect(),t){let n=[],s=t.inspect();for(let a in s)s[a]?n.push(`${a}: ${s[a]}`):n.push(`${a}`);Tr(ws(tn()),n.join(`
`))}Tr(R(8),`FPS: ${ue.fps()}`)}ue.paused&&Ue(()=>{ve(),ae(Re(),0),ae(-8,8);let t=32;Ae({width:t,height:t,anchor:"topright",color:re(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=1;n<=2;n++)Ae({width:4,height:t*.6,anchor:"center",pos:R(-t/3*n,t*.5),color:re(255,255,255),radius:2,fixed:!0});fe()}),ue.timeScale!==1&&Ue(()=>{ve(),ae(Re(),Ge()),ae(-8,-8);let t=8,n=ht({text:ue.timeScale.toFixed(1),font:wn,size:16,color:re(255,255,255),pos:R(-t),anchor:"botright",fixed:!0});Ae({width:n.width+t*2+t*4,height:n.height+t*2,anchor:"botright",color:re(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=0;s<2;s++){let a=ue.timeScale<1;D({p1:R(-n.width-t*(a?2:3.5),-t),p2:R(-n.width-t*(a?2:3.5),-t-n.height),p3:R(-n.width-t*(a?3.5:2),-t-n.height/2),pos:R(-s*t*1+(a?-t*.5:0),0),color:re(255,255,255),fixed:!0})}lt(n),fe()}),ue.curRecording&&Ue(()=>{ve(),ae(0,Ge()),ae(24,-24),H({radius:12,color:re(255,0,0),opacity:Wn(0,1,v.time()*4),fixed:!0}),fe()}),ue.showLog&&O.logs.length>0&&Ue(()=>{var a;ve(),ae(0,Ge()),ae(8,-8);let t=8,n=[];for(let u of O.logs){let f="",m=u.msg instanceof Error?"error":"info";f+=`[time]${u.time.toFixed(2)}[/time]`,f+=" ",f+=`[${m}]${(a=u.msg)!=null&&a.toString?u.msg.toString():u.msg}[/${m}]`,n.push(f)}O.logs=O.logs.filter(u=>v.time()-u.time<(r.logTime||ho));let s=ht({text:n.join(`
`),font:wn,pos:R(t,-t),anchor:"botleft",size:16,width:Re()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:re(127,127,127)},info:{color:re(255,255,255)},error:{color:re(255,0,127)}}});Ae({width:s.width+t*2,height:s.height+t*2,anchor:"botleft",color:re(0,0,0),radius:4,opacity:.8,fixed:!0}),lt(s),fe()})}o(Ti,"drawDebug");function Ai(t){O.events.on("loading",t)}o(Ai,"onLoading");function Oi(t){v.onResize(t)}o(Oi,"onResize");function Ri(t){O.events.on("error",t)}o(Ri,"onError");function Pi(t){console.error(t),oe.ctx.suspend(),v.run(()=>{Rt(),Ue(()=>{let a=Re(),u=Ge(),f={size:36,width:a-32*2,letterSpacing:4,lineSpacing:4,font:wn,fixed:!0};Ae({width:a,height:u,color:re(0,0,255),fixed:!0});let m=ht(mt(Ye({},f),{text:"Error",pos:R(32),color:re(255,128,0),fixed:!0}));lt(m),fr(mt(Ye({},f),{text:t.message,pos:R(32,32+m.height+16),fixed:!0})),fe(),O.events.trigger("error",t)}),Pt()})}o(Pi,"handleErr");function Di(t){ee.push(t)}o(Di,"onCleanup");function Mi(){O.events.onOnce("frameEnd",()=>{v.quit(),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT|A.STENCIL_BUFFER_BIT);let t=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<t;n++)A.activeTexture(A.TEXTURE0+n),A.bindTexture(A.TEXTURE_2D,null),A.bindTexture(A.TEXTURE_CUBE_MAP,null);A.bindBuffer(A.ARRAY_BUFFER,null),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,null),A.bindRenderbuffer(A.RENDERBUFFER,null),A.bindFramebuffer(A.FRAMEBUFFER,null),Y.destroy(),ee.forEach(n=>n())})}o(Mi,"quit");let cn=!0;v.run(()=>{try{N.loaded||W()===1&&!cn&&(N.loaded=!0,O.events.trigger("load")),!N.loaded&&r.loadingScreen!==!1||cn?(Rt(),Ci(),Pt()):(ue.paused||Cr(),Ei(),Rt(),Si(),r.debug!==!1&&Ti(),Pt()),cn&&(cn=!1),O.events.trigger("frameEnd")}catch(t){Pi(t)}});function Ar(){let t=M,n=A.drawingBufferWidth/t,s=A.drawingBufferHeight/t;if(r.letterbox){if(!r.width||!r.height)throw new Error("Letterboxing requires width and height defined.");let a=n/s,u=r.width/r.height;if(a>u){let f=s*u,m=(n-f)/2;S.viewport={x:m,y:0,width:f,height:s}}else{let f=n/u,m=(s-f)/2;S.viewport={x:0,y:m,width:n,height:f}}return}if(r.stretch&&(!r.width||!r.height))throw new Error("Stretching requires width and height defined.");S.viewport={x:0,y:0,width:n,height:s}}o(Ar,"updateViewport");function Or(){v.onHide(()=>{r.backgroundAudio||oe.ctx.suspend()}),v.onShow(()=>{!r.backgroundAudio&&!ue.paused&&oe.ctx.resume()}),v.onResize(()=>{if(v.isFullscreen())return;let t=r.width&&r.height;t&&!r.stretch&&!r.letterbox||(i.width=i.offsetWidth*M,i.height=i.offsetHeight*M,Ar(),t||(S.frameBuffer.free(),S.frameBuffer=new at(Y,A.drawingBufferWidth,A.drawingBufferHeight),S.width=A.drawingBufferWidth/M,S.height=A.drawingBufferHeight/M))}),r.debug!==!1&&(v.onKeyPress("f1",()=>ue.inspect=!ue.inspect),v.onKeyPress("f2",()=>ue.clearLog()),v.onKeyPress("f8",()=>ue.paused=!ue.paused),v.onKeyPress("f7",()=>{ue.timeScale=Dt(et(ue.timeScale-.2,0,2),1)}),v.onKeyPress("f9",()=>{ue.timeScale=Dt(et(ue.timeScale+.2,0,2),1)}),v.onKeyPress("f10",()=>ue.stepFrame())),r.burp&&v.onKeyPress("b",()=>Qt())}o(Or,"initEvents"),Ar(),Or();let ft={VERSION:io,loadRoot:qe,loadProgress:W,loadSprite:ut,loadSpriteAtlas:Ht,loadSound:Cn,loadBitmapFont:yn,loadFont:vt,loadShader:En,loadShaderURL:Sn,loadAseprite:Un,loadPedit:xn,loadBean:Tn,loadJSON:De,load:He,getSprite:$t,getSound:zt,getFont:Kt,getBitmapFont:Yt,getShader:Wt,getAsset:An,Asset:ye,SpriteData:X,SoundData:ne,width:Re,height:Ge,center:an,dt:Ke,time:v.time,screenshot:v.screenshot,record:mi,isFocused:pi,setCursor:v.setCursor,getCursor:v.getCursor,setCursorLocked:v.setCursorLocked,isCursorLocked:v.isCursorLocked,setFullscreen:v.setFullscreen,isFullscreen:v.isFullscreen,isTouchscreen:v.isTouchscreen,onLoad:Nn,onLoading:Ai,onResize:Oi,onGamepadConnect:v.onGamepadConnect,onGamepadDisconnect:v.onGamepadDisconnect,onError:Ri,onCleanup:Di,camPos:bs,camScale:vs,camRot:ys,shake:xs,toScreen:pr,toWorld:gr,setGravity:Ds,getGravity:Ms,setBackground:Gs,getBackground:Bs,getGamepads:v.getGamepads,add:Gt,make:In,destroy:gi,destroyAll:bi,get:jn,readd:wi,pos:sn,scale:on,rotate:Fs,color:Is,opacity:Ls,anchor:Vn,area:Hs,sprite:_n,text:qs,polygon:$s,rect:zs,circle:Ys,uvquad:Ks,outline:Ws,body:Qs,doubleJump:Zs,shader:ei,timer:kn,fixed:ti,stay:br,health:ni,lifespan:ri,z:Vs,move:ks,offscreen:js,follow:_s,state:si,fadeIn:ii,mask:oi,drawon:ai,tile:Ur,agent:fi,on:it,onUpdate:Us,onDraw:Es,onAdd:Ln,onDestroy:wr,onClick:As,onCollide:Ss,onCollideUpdate:Cs,onCollideEnd:Ts,onHover:Os,onHoverUpdate:Rs,onHoverEnd:Ps,onKeyDown:v.onKeyDown,onKeyPress:v.onKeyPress,onKeyPressRepeat:v.onKeyPressRepeat,onKeyRelease:v.onKeyRelease,onMouseDown:v.onMouseDown,onMousePress:v.onMousePress,onMouseRelease:v.onMouseRelease,onMouseMove:v.onMouseMove,onCharInput:v.onCharInput,onTouchStart:v.onTouchStart,onTouchMove:v.onTouchMove,onTouchEnd:v.onTouchEnd,onScroll:v.onScroll,onHide:v.onHide,onShow:v.onShow,onGamepadButtonDown:v.onGamepadButtonDown,onGamepadButtonPress:v.onGamepadButtonPress,onGamepadButtonRelease:v.onGamepadButtonRelease,onGamepadStick:v.onGamepadStick,mousePos:tn,mouseDeltaPos:v.mouseDeltaPos,isKeyDown:v.isKeyDown,isKeyPressed:v.isKeyPressed,isKeyPressedRepeat:v.isKeyPressedRepeat,isKeyReleased:v.isKeyReleased,isMouseDown:v.isMouseDown,isMousePressed:v.isMousePressed,isMouseReleased:v.isMouseReleased,isMouseMoved:v.isMouseMoved,isGamepadButtonPressed:v.isGamepadButtonPressed,isGamepadButtonDown:v.isGamepadButtonDown,isGamepadButtonReleased:v.isGamepadButtonReleased,getGamepadStick:v.getGamepadStick,charInputted:v.charInputted,loop:vi,wait:Er,play:Jt,volume:Pn,burp:Qt,audioCtx:oe.ctx,Line:Ve,Rect:le,Circle:ot,Polygon:Ne,Vec2:y,Color:$,Mat4:ie,Quad:se,RNG:xt,rand:Ft,randi:Xn,randSeed:Ir,vec2:R,rgb:re,hsl2rgb:Fr,quad:we,choose:Vr,chance:Lr,lerp:tt,tween:Hn,easings:Nt,map:nt,mapc:Br,wave:Wn,deg2rad:We,rad2deg:Ut,clamp:et,testLineLine:yt,testRectRect:_r,testRectLine:kr,testRectPoint:Bt,testCirclePolygon:Hr,testLinePoint:Nr,testLineCircle:Jn,drawSprite:Bn,drawText:fr,formatText:ht,drawRect:Ae,drawLine:d,drawLines:U,drawTriangle:D,drawCircle:H,drawEllipse:me,drawUVQuad:Qe,drawPolygon:Oe,drawFormattedText:lt,drawMasked:ze,drawSubtracted:he,pushTransform:ve,popTransform:fe,pushTranslate:ae,pushScale:rt,pushRotate:ce,pushMatrix:en,usePostEffect:Zt,makeCanvas:Dn,debug:ue,scene:ui,go:ci,onSceneLeave:hi,addLevel:di,getData:li,setData:vr,download:ln,downloadJSON:Kr,downloadText:Zn,downloadBlob:er,plug:yr,ASCII_CHARS:as,canvas:v.canvas,addKaboom:Ui,LEFT:y.LEFT,RIGHT:y.RIGHT,UP:y.UP,DOWN:y.DOWN,RED:$.RED,GREEN:$.GREEN,BLUE:$.BLUE,YELLOW:$.YELLOW,MAGENTA:$.MAGENTA,CYAN:$.CYAN,WHITE:$.WHITE,BLACK:$.BLACK,quit:Mi,Event:Ce,EventHandler:Xe,EventController:je};if(r.plugins&&r.plugins.forEach(yr),r.global!==!1)for(let t in ft)window[t]=ft[t];return r.focus!==!1&&v.canvas.focus(),ft},"default");export{ca as default};
//# sourceMappingURL=kaboom.mjs.map
